---
title: "Annual Total BC Dissimilarity vs. OISST Temperature for all Survey Units"
output: html_notebook
---

This code is Script 7b for Kitchel et al. Biotic homogenization, the exception and not the rule for marine fish communities manuscript.

- This project is a collaborative effort to describe changes in taxonomic composition  of fish communities around the world--as sampled by surface trawl surveys.

- Code by Zoë J. Kitchel

SESSION INFO TO DO

##Here, we use surface temperature to predict annual dissimilarity for all survey units

```{r setup}

library(data.table)
library(ggplot2)
library(lme4)
library(lmerTest)
library(MuMIn)


OISST_data_temp_avgs_full <- readRDS(here::here("data","Temperature","OISST_data_temp_avgs_full.rds"))
#don't feel confident about OISST temp before 1980 right now, start then

OISST_data_temp_avgs_full <- OISST_data_temp_avgs_full[year_for_avg >= 1980,]

OISST_data_temp_avgs_full[,year := year_for_avg]

#pull in average distance decay values
distances_dissimilarities_allyears.r <- readRDS(here::here("output","dissimilarities","distances_dissimilarities_allyears.r.rds"))

```

Model to extract p value from overall model
```{r}
#define function to extract overall p-value of model
overall_p <- function(my_model) {
    f <- summary(my_model)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)
}
```


###Palette for Plotting and name helper
Palette for plotting all 42 survey units
(Prep for eventual plots)
Full Name Helper

```{r}

name_helper <- data.table(Survey_Name_Season = c("Aleutian Islands",
                                    "Baltic Sea Q1",
                                    "Baltic Sea Q4",
                                    "Chile",
                                    "Newfoundland",
                                    "Queen Charlotte Sound",
                                    "Eastern Bering Sea",
                                    "Bay of Biscay",
                                    "English Channel",
                                    "Gulf of Mexico Summer",
                                    "Gulf of Alaska",
                                    "Greenland",
                                    "N Gulf of St. Lawrence",
                                    "S Gulf of St. Lawrence",
                                    "Iceland",
                                    "Irish Sea",
                                    "Mediterranean",
                                    "Namibia",
                                    "NE US Fall",
                                    "NE US Spring",
                                    "N Ireland Q1",
                                    "N Ireland Q4",
                                    "Barents Sea Norway Q3",
                                    "N Sea Q1",
                                    "N Sea Q3",
                                    "Chatham Rise NZ",
                                    "E Coast S Island NZ",
                                    "W Coast S Island NZ",
                                    "Portugal",
                                    "S Georgia",
                                  "Scotian Shelf Summer",
                                  "SE US Fall",
                                  "SE US Spring",
                                  "SE US Summer",
                                  "W Coast US",
                                  "Atlantic Ocean ZA",
                                  "Indian Ocean ZA",
                                   "Rockall Plateau",
                                  "Scotland Shelf Sea Q1",
                                  "Scotland Shelf Sea Q4",
                                  "Falkland Islands",
                                  "Gulf of Mexico Fall",
                                  "Barents Sea Norway Q1",
                                  "Sub-Arctic NZ",
                                  "Scotian Shelf Spring"),
                          survey_unit = c(
                                  "AI",        
                                  "BITS-1",    
                                  "BITS-4",    
                                  "CHL",       
                                  "DFO-NF",    
                                  "DFO-QCS",   
                                  "EBS",       
                                  "EVHOE",     
                                  "FR-CGFS",   
                                  "GMEX-Summer",
                                  "GOA",       
                                  "GRL-DE",    
                                  "GSL-N",     
                                  "GSL-S",     
                                  "ICE-GFS",   
                                  "IE-IGFS",   
                                  "MEDITS",    
                                  "NAM",       
                                  "NEUS-Fall", 
                                  "NEUS-Spring",
                                  "NIGFS-1",   
                                  "NIGFS-4",   
                                  "Nor-BTS-3", 
                                  "NS-IBTS-1", 
                                  "NS-IBTS-3", 
                                  "NZ-CHAT",   
                                  "NZ-ECSI",   
                                  "NZ-WCSI",   
                                  "PT-IBTS",   
                                  "S-GEORG",   
                                  "SCS-SUMMER",
                                  "SEUS-fall", 
                                  "SEUS-spring",
                                  "SEUS-summer",
                                  "WCANN",     
                                  "ZAF-ATL",   
                                  "ZAF-IND",
                                  "ROCKALL",
                                  "SWC-IBTS-1",
                                  "SWC-IBTS-4",
                                  "FALK",
                                  "GMEX-Fall",
                                  "Nor-BTS-1",
                                  "NZ-SUBA",
                                  "SCS-SPRING"
                          ))



```

Color link
```{r}
survey_unit.list <- levels(factor(distances_dissimilarities_allyears.r[,survey_unit]))

palette_42 <- c(
  "#5A5156", #AI
  "#DF00DB", #BITS-1
  "#DB8EDA", #BITS-4
  "#F6222E", #CHL
  "#F8A19F", #DFO-NF
  "#16FF32", #DFO-QCS
  "#325A9B", #EBS
  "#3283FE", #EVHOE
  "#FEAF16", #FR-CGFS
  "#fccb6d", #GMEX-Fall
  "#1C8356", #GMEX-Summer
  "#C4451C", #GOA
  "#85660D", #GRL-DE
  "#B0009F", #GSL-N
  "#BF79B8", #GSL-S
  "#1CBE4F", #ICE-GFS
  "#782AB6", #IE-IGFS
  "#90AD1C", #MEDITS
  "#6B003A", #NAM
  "#A75B00", #NEUS-Fall
  "#E3B072", #NEUS-Spring
  "#02E8B6", #NIGFS-1
  "#97E7D5", #NIGFS-4
  "#B00068", #Nor-BTS-3
  "#00B9E3", #NS-IBTS-1
  "#95E2F4", #NS-IBTS-3
  "#B3CE73", #NZ-CHAT
  "#689500", #NZ-ECSI
  "#364d02",#NZ-SUBA
  "#AAF400", #NZ-WCSI
  "#AA0DFE", #PT-IBTS
  "#7f9eb8", #ROCKALL
  "#FA0087", #S-GEORG
  "#DEA0FD", #SCS-Summer
  "#FCEF88", #SEUS-fall
  "#A59405", #SEUS-spring
  "#FCE100", #SEUS-summer
  "#544563", #SWC-IBTS-1
  "#a37fc7", #SWC-IBTS-4
  "#C075A6", #WCANN
  "#BDCDFF", #ZAF-ATL
  "#003EFF"  #ZAF-IND
)

color_link <- data.table(survey_unit = survey_unit.list,hex = palette_42)

color_link <- name_helper[color_link, on = "survey_unit", nomatch = NULL]
```


Put into one data table
```{r link temp to avg values}
dissimilarities_temp <- OISST_data_temp_avgs_full[distances_dissimilarities_allyears.r, on = c("year","survey_unit")]

#few empty temp rows for early and late years (only 22, delete)
dissimilarities_temp <- na.omit(dissimilarities_temp)

#get rid of any years not between 1981-2019
dissimilarities_temp <- dissimilarities_temp[year >= 1981 & year <=2019]
```

Pull in dissimilarity ~ model coefficients
```{r}
BC_total_model_coefs_reduced_length.unique <- readRDS(here::here("output","region_stats","BC_total_model_coefs_reduced_length.unique.Rds"))
```



Table that will be populated with model results
```{r}
#depth, scaled, temp var, coefficient, p-value, r^2, AICc
total_dissimilarity_sst_model_results <- data.table(Depth = as.character(),
                                                       Scaled = as.character(),
                                                       `Temp variable` = as.character(),
                                                       Intercept = as.numeric(),
                                                       `Temp coefficient` = as.numeric(),
                                                       `Temp p-value` = as.numeric(),
                                                       `R-squared` = as.numeric(),
                                                       AICc = as.numeric())
                                                  
```


How does this trend hold up for all regions?
###UNSCALED

####Mean temperature
```{r mean sst}
#for all regions
(dissimilarity_BC_total_sst_mean <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_42)) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_total_sst_mean, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_mean.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_mean_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_mean_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_mean_facet.jpg", height = 10, width = 11, unit = "in")

#TEMP ONLY
dissimilarity_BC_total_sst_mean_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg, data = dissimilarities_temp) 

summary(dissimilarity_BC_total_sst_mean_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_mean_bypoint_avg", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_mean_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_mean_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#MEAN TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_mean_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_mean_bypoint_avg + survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_plus_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_plus_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_mean_plus_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_mean_plus_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#MEAN TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_mean_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_mean_bypoint_avg * survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_times_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_times_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_mean_times_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_mean_times_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#table of individual interaction coefficients
best_sst_mod_coefs_dt <- data.table(coefs)
best_sst_mod_coefs_dt[,predictor:=rownames(coefs)]
fwrite(best_sst_mod_coefs_dt, here::here("output","best_sst_mod_coefs_dt.csv"))
```

####Min temperature
```{r min sst}
#for all regions
(dissimilarity_BC_total_sst_min <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_42)) +
  geom_smooth(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_total_sst_min, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_min.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_min_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_min_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_min_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_min_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_min_bypoint_avg, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_min_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_min_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_min_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_min_bypoint_avg", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_min_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_min_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_min_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_min_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#min TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_min_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_min_bypoint_avg + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_min_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_min_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_min_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_min_bypoint_avg + survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_min_plus_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_min_plus_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #model pvalue
                                                 round(summary(dissimilarity_BC_total_sst_min_plus_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_min_plus_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#min TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_min_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_min_bypoint_avg * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_min_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_min_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_min_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_min_bypoint_avg * survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_min_times_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_min_times_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_min_times_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_min_times_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)
```

####Max sst
```{r max sst}
#for all regions
(dissimilarity_BC_total_sst_max <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_42)) +
  geom_smooth(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_total_sst_max, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_max.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_max_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_max_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_max_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_max_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_max_bypoint_avg, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_max_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_max_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_max_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_max_bypoint_avg", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_max_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_max_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_max_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_max_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#max TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_max_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_max_bypoint_avg + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_max_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_max_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_max_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_max_bypoint_avg + survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_max_plus_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_max_plus_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_max_plus_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_max_plus_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#max TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_max_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_max_bypoint_avg * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_max_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_max_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_max_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_max_bypoint_avg * survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_max_times_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_max_times_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_max_times_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_max_times_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

```

####Seas sst
```{r seas sst}
#for all regions
(dissimilarity_BC_total_sst_seas <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_42)) +
  geom_smooth(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_total_sst_seas, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_seas.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_seas_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_seas_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_seas_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_seas_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_seas_bypoint_avg, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_seas_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_seas_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_seas_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_seas_bypoint_avg", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_seas_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_seas_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#seas TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_seas_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_seas_bypoint_avg + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_seas_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_seas_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_seas_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_seas_bypoint_avg + survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas_plus_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas_plus_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #model pvalue
                                                 round(summary(dissimilarity_BC_total_sst_seas_plus_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_seas_plus_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#seas TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_seas_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_seas_bypoint_avg * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_seas_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_seas_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_seas_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_seas_bypoint_avg * survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas_times_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas_times_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_seas_times_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_seas_times_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)


```
SD of mean
```{r}
#for all regions
(dissimilarity_BC_total_sst_meanSD <- ggplot(data = dissimilarities_temp) +
  labs(x = "SD ",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_42)) +
  geom_smooth(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_total_sst_meanSD, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_meanSD.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_meanSD_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "SD of mean surface temperature",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_meanSD_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_meanSD_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_meanSD_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_SD, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_meanSD_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_meanSD_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_meanSD_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_mean_bypoint_SD", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_meanSD_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_meanSD_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_meanSD_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_meanSD_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#SD TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_meanSD_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_SD + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_meanSD_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_meanSD_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_meanSD_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_mean_bypoint_SD + survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_meanSD_plus_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_meanSD_plus_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(round(coefs[2,4],3)), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_meanSD_plus_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_meanSD_plus_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#SD TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_meanSD_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_SD * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_meanSD_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_meanSD_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_meanSD_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                 F, #scaled
                                                 "yearly_mean_bypoint_SD * survey_unit", #model structure
                                                 paste0(round(coef(dissimilarity_BC_total_sst_meanSD_times_survey_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_total_sst_meanSD_times_survey_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 signif(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_total_sst_meanSD_times_survey_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_total_sst_meanSD_times_survey_mod),3)
                                                 ),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)
```


###Raw temp values: Comparing temperature predictors for raw
```{r compare raw temp predictors}

setorder(total_dissimilarity_sst_model_results,AICc)
View(total_dissimilarity_sst_model_results)


```

---
##SCALED
###Avg of grid cells
####Mean temperature scaled
```{r mean sst scaled}
#for all regions
(dissimilarity_BC_total_sst_mean.s <- ggplot(data = dissimilarities_temp) +
    labs(x = "Mean surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
    geom_point(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
    geom_line(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
    scale_color_manual(values = c(palette_42)) +
    geom_smooth(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
    theme_classic())

ggsave(dissimilarity_BC_total_sst_mean.s, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_mean.s.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_mean.s_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_mean.s_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_mean.s_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_mean.s_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg.s, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean.s_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean.s_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean.s_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_mean_bypoint_avg.s", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean.s_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean.s_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 round(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_mean.s_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_mean.s_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#MEAN TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_mean.s_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg.s + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean.s_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean.s_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean.s_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_mean_bypoint_avg.s + survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean.s_plus_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean.s_plus_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_mean.s_plus_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_mean.s_plus_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#MEAN TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_mean.s_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg.s * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean.s_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean.s_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean.s_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_mean_bypoint_avg.s * survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean.s_times_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean.s_times_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_mean.s_times_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_mean.s_times_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)
```

####Min temperature
```{r min sst scaled}
#for all regions
(dissimilarity_BC_total_sst_min.s <- ggplot(data = dissimilarities_temp) +
    labs(x = "Min surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
    geom_point(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
    geom_line(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
    scale_color_manual(values = c(palette_42)) +
    geom_smooth(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
    theme_classic())

ggsave(dissimilarity_BC_total_sst_min.s, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_min.s.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_min.s_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_min.s_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_min.s_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_min.s_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_min_bypoint_avg.s, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_min.s_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_min.s_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_min.s_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_min_bypoint_avg.s", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_min.s_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_min.s_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 round(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_min.s_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_min.s_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#min TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_min.s_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_min_bypoint_avg.s + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_min.s_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_min.s_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_min.s_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_min_bypoint_avg.s + survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_min.s_plus_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_min.s_plus_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_min.s_plus_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_min.s_plus_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#min TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_min.s_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_min_bypoint_avg.s * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_min.s_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_min.s_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_min.s_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_min_bypoint_avg.s * survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_min.s_times_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_min.s_times_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_min.s_times_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_min.s_times_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)
```

####Max sst
```{r max sst scaled}
#for all regions
(dissimilarity_BC_total_sst_max.s <- ggplot(data = dissimilarities_temp) +
    labs(x = "Max surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
    geom_point(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
    geom_line(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
    scale_color_manual(values = c(palette_42)) +
    geom_smooth(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
    theme_classic())

ggsave(dissimilarity_BC_total_sst_max.s, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_max.s.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_max.s_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_max.s_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_max.s_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_max.s_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_max_bypoint_avg.s, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_max.s_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_max.s_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_max.s_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_max_bypoint_avg.s", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_max.s_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_max.s_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 round(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_max.s_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_max.s_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#max TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_max.s_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_max_bypoint_avg.s + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_max.s_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_max.s_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_max.s_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_max_bypoint_avg.s + survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_max.s_plus_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_max.s_plus_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_max.s_plus_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_max.s_plus_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#max TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_max.s_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_max_bypoint_avg.s * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_max.s_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_max.s_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_max.s_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_max_bypoint_avg.s * survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_max.s_times_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_max.s_times_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_max.s_times_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_max.s_times_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

```

####Seas sst
```{r seas sst scaled}
#for all regions
(dissimilarity_BC_total_sst_seas.s <- ggplot(data = dissimilarities_temp) +
    labs(x = "Seasonality of surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
    geom_point(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
    geom_line(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
    scale_color_manual(values = c(palette_42)) +
    geom_smooth(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
    theme_classic())

ggsave(dissimilarity_BC_total_sst_seas.s, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_seas.s.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_seas.s_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of surface temperature scaled (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_seas.s_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_seas.s_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_seas.s_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_seas_bypoint_avg.s, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_seas.s_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_seas.s_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_seas.s_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_seas_bypoint_avg.s", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas.s_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas.s_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 round(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_seas.s_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_seas.s_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#seas TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_seas.s_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_seas_bypoint_avg.s + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_seas.s_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_seas.s_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_seas.s_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_seas_bypoint_avg.s + survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas.s_plus_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas.s_plus_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_seas.s_plus_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_seas.s_plus_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#seas TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_seas.s_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_seas_bypoint_avg.s * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_seas.s_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_seas.s_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_seas.s_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_seas_bypoint_avg.s * survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas.s_times_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_seas.s_times_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_seas.s_times_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_seas.s_times_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)


```

SD of mean
```{r sd of mean scaled}
#for all regions
(dissimilarity_BC_total_sst_mean_SD.s <- ggplot(data = dissimilarities_temp) +
    labs(x = "SD ",  y = "Bray Curtis total dissimilarity") +
    geom_point(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), alpha = 0.3) +
    geom_line(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_total_mean, color = survey_unit), stat="smooth", method = "lm") +
    scale_color_manual(values = c(palette_42)) +
    geom_smooth(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_total_mean), method = "lm", se = F, color  = "black") +
    theme_classic())

ggsave(dissimilarity_BC_total_sst_mean_SD.s, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_mean_SD.s.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_total_sst_mean_SD.s_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "SD of mean surface temperature scaled",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_total_sst_mean_SD.s_facet, path  = here::here("figures","dissimilarities"), filename = "dissimilarity_BC_total_sst_mean_SD.s_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_total_sst_mean_SD.s_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_SD.s, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean_SD.s_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean_SD.s_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean_SD.s_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_mean_bypoint_SD.s", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_SD.s_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_SD.s_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 round(coefs[2,4],3), #pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_mean_SD.s_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_mean_SD.s_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#SD TEMP PLUS SURVEY UNIT
#########################
dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_SD.s + survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_mean_bypoint_SD.s + survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_mean_SD.s_plus_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)

#########################
#SD TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_SD.s * survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c("sst", #depth
                                                                 T, #scaled
                                                                 "yearly_mean_bypoint_SD.s * survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 paste0(round(coef(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod)[[2]],3),
                                                                        " ± ",
                                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                                 signif(coefs[2,4],3), #model pvalue
                                                                 round(summary(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_sst_mean_SD.s_times_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)
```

#add survey unit only model
```{r}
#########################
#SD TEMP * SURVEY UNIT
#########################
dissimilarity_BC_total_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ survey_unit, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_total_survey_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_total_survey_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_total_survey_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
total_dissimilarity_sst_model_results_row <- data.table(matrix(c(NA, #depth
                                                                 NA, #scaled
                                                                 "survey_unit", #model structure
                                                                 paste0(round(coef(dissimilarity_BC_total_survey_mod)[[1]],3),
                                                                        " ± ",
                                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                                 NA, #coef
                                                                 NA, #pvalue
                                                                 round(summary(dissimilarity_BC_total_survey_mod)$r.squared,3),#rsquared
                                                                 round(AICc(dissimilarity_BC_total_survey_mod),3)
),nrow = 1))

#merge with larger table
total_dissimilarity_sst_model_results <- rbind(total_dissimilarity_sst_model_results,total_dissimilarity_sst_model_results_row, use.names = F)
```


Comparing temperature predictors for all (absolute/raw and scaled)
```{r compare all temp predictors}

setorder(total_dissimilarity_sst_model_results,AICc)
total_dissimilarity_sst_model_results[,deltaAICc := (as.numeric(AICc) - min(as.numeric(AICc)))]
View(total_dissimilarity_sst_model_results)
```


####What to carry forward:

best model:
	
yearly_mean_bypoint_avg * survey_unit

dissimilarity_BC_total_sst_mean_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg * survey_unit, data = dissimilarities_temp)

Merge dissimilarities temp with names for plotting
```{r}
dissimilarities_temp <- dissimilarities_temp[color_link, on = "survey_unit"]


```



Best models
```{r}
total_dissimilarity_sst_model_results

saveRDS(total_dissimilarity_sst_model_results, here::here("output","total_dissimilarity_sst_model_results.rds"))
fwrite(total_dissimilarity_sst_model_results, here::here("output","total_dissimilarity_sst_model_results.csv"))
```


####Plot best absolute model

dissimilarity_BC_total_sst_mean_times_survey_mod <- lm(bray_curtis_dissimilarity_total_mean ~ yearly_mean_bypoint_avg * survey_unit, data = dissimilarities_temp)


```{r}

#for all regions merged
(preds_sst_mean_temp_survey <- ggplot() +
  labs(x = "Mean surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(data = dissimilarities_temp, aes(x = as.numeric(yearly_mean_bypoint_avg), y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(data = dissimilarities_temp, aes(x = as.numeric(yearly_mean_bypoint_avg), y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  theme_classic())

ggsave(preds_sst_mean_temp_survey, path  = here::here("figures","predictor_variables"), filename = "preds_sst_mean_temp_survey.jpg", height = 4, width = 6.5, unit = "in") 

(preds_sst_mean_temp_survey_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean surface temperature (˚C)",  y = "Bray Curtis total dissimilarity") +
  geom_point(aes(x = as.numeric(yearly_mean_bypoint_avg), y = bray_curtis_dissimilarity_total_mean), alpha = 0.3) +
  geom_smooth(aes(x = as.numeric(yearly_mean_bypoint_avg), y = bray_curtis_dissimilarity_total_mean), method = "lm") +
  facet_wrap(~Survey_Name_Season, scales= "free", ncol = 5) +
  theme_classic())


ggsave(preds_sst_mean_temp_survey_facet, path  = here::here("figures","predictor_variables"), filename = "preds_sst_mean_temp_survey_facet.jpg", height = 13, width = 10, unit = "in")

```
