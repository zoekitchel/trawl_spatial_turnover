---
title: "Dissimilarity Temperature & Fishing Regression for All Regions"
output: html_notebook
---

Here we will finally link temperature and fishing to dissimilarity


```{r setup}

library(data.table)
library(ggplot2)
library(lme4)
library(lmerTest)


OISST_data_temp_avgs_full <- readRDS(here::here("data","Temperature","OISST_data_temp_avgs_full.rds"))

OISST_data_temp_avgs_full[,year := year_for_avg]


#pull in average distance decay values
distances_dissimilarities_allyears.r <- readRDS(here::here("output","distance_decay","distances_dissimilarities_allyears.r.rds"))

#old
#pull in average distance decay values
#distances_dissimilarities_allyears.year.models <- readRDS(here::here("output","distance_decay","distances_dissimilarities_allyears.year.models.rds"))

#pull in fishing data
SAU_summed_tonnes.r <- readRDS(here::here("data","sea_around_us","SAU_summed_tonnes.rds"))

```

Put into one data table
```{r link temp and fishing to avg values}
#temp
distances_dissimilarities_allyears.r.temp <- OISST_data_temp_avgs_full[distances_dissimilarities_allyears.r, on = c("year","survey_unit")]

#fishing
dissimilarities_temp_fishing <- SAU_summed_tonnes.r[distances_dissimilarities_allyears.r.temp, on = c("year", "survey_unit")]

#save avg values
saveRDS(dissimilarities_temp_fishing, here::here("output","distance_decay","dissimilarities_temp_fishing.rds"))
```

Plotting with fishing

```{r EBS fishing}

#fishing over time
ebs_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS",]) +
  geom_point(aes(x = year, y = summed_tonnes), color  = "#325A9B") +
  labs(x = "Year",  y = "Total Landings (tonnes)") +
  theme_classic()

#for just EBS
(ebs_dissimilarity_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS",]) +
  geom_smooth(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "#325A9B") +
  labs(x = "Total Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color  = "#325A9B", alpha = 0.3) +
  theme_classic())

ggsave(ebs_dissimilarity_fishing, path  = here::here("figures","distance_decay"), filename = "ebs_dissimilarity_fishing.jpg") 

ebs_dissimilarity_fishing_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes, data = dissimilarities_temp_fishing[survey_unit == "EBS",])

summary(ebs_dissimilarity_fishing_mod)
```

How does this trend hold up for all regions?
```{r temp all regions}
#for all regions
(allreg_dissimilarity_fishing_mean <- ggplot(data = dissimilarities_temp_fishing) +
  labs(x = "Scaled Landings by Survey Unit (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values =  palette_37 <- c(
  "#5A5156", #AI
  "#F6222E", #CHL
  "#F8A19F", #DFO-NF
  "#16FF32", #DFO-QCS
  "#DF00DB", #BITS-1
  "#DB8EDA", #BITS-4
  "#325A9B", #EBS
  "#3283FE", #EVHOE
  "#FEAF16", #FR-CGFS
  "#1C8356", #GMEX-Summer
  "#C4451C", #GOA
  "#85660D", #GRL-DE
  "#B0009F", #GSL-N
  "#BF79B8", #GSL-S
  "#1CBE4F", #ICE-GFS
  "#782AB6", #IE-IGFS
  "#90AD1C", #MEDITS
  "#6B003A", #NAM
  "#A75B00", #NEUS-Fall
  "#E3B072", #NEUS-Spring
  "#02E8B6", #NIGFS-1
  "#97E7D5", #NIGFS-4
  "#B00068", #Nor-BTS-3
  "#00B9E3", #NS-IBTS-1
  "#95E2F4", #NS-IBTS-3
  "#B3CE73", #NZ-CHAT
  "#689500", #NZ-ECSI
  "#AAF400", #NZ-WCSI
  "#AA0DFE", #PT-IBTS
  "#FA0087", #S-GEORG
  "#DEA0FD", #SCS-Summer
  "#FCEF88", #SEUS-fall
  "#A59405", #SEUS-spring
  "#FCE100", #SEUS-summer
  "#C075A6", #WCANN
  "#BDCDFF", #ZAF-ATL
  "#003EFF"  #ZAF-IND
)) +
  geom_smooth(aes(x = summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black", size = 1) +
  theme_classic() +
    theme(legend.position = "none"))

#all one color points
(allreg_dissimilarity_fishing_mean_SIMPLIFIED <- ggplot(data = dissimilarities_temp_fishing) +
  labs(x = "Scaled Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes_scaled, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = summed_tonnes_scaled, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic() +
    theme(legend.position = "none"))

ggsave(allreg_dissimilarity_fishing_mean, path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_fishing_mean.jpg", height = 4, width = 9, unit = "in") 

#random effect for survey
allreg_dissimilarity_fishing_mean_mod <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg + (1|survey_unit), data = dissimilarities_temp_fishing)

#no random effect for survey
allreg_dissimilarity_fishing_mean_mod_lm <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg, data = dissimilarities_temp_fishing)

#In years of higher than average fishing pressure, dissimilarity is lower (homogenization)

summary(allreg_dissimilarity_fishing_mean_mod)

library(MuMIn)
r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod)


```

Full mods (temp * fishing)
```{r}

#BEST MODEL with minimum temp
allreg_dissimilarity_fishing_temp_mod_1 <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_min_bypoint_avg*yearly_min_bypoint_avg.s + (1|survey_unit), data = dissimilarities_temp_fishing)

  #what if we delete interaction? 
  allreg_dissimilarity_fishing_temp_mod_1.1 <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg + sst_min_scaled + (1|survey_unit), data = dissimilarities_temp_fishing)

allreg_dissimilarity_fishing_temp_mod_2 <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*sst_max_scaled + (1|survey_unit), data = dissimilarities_temp_fishing)

allreg_dissimilarity_fishing_temp_mod_3 <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*sst_mean_scaled + (1|survey_unit), data = dissimilarities_temp_fishing)

allreg_dissimilarity_fishing_temp_mod_4 <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*sst_seas_scaled + (1|survey_unit), data = dissimilarities_temp_fishing)

allreg_dissimilarity_fishing_temp_mod_5 <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*sst_SD_scaled + (1|survey_unit), data = dissimilarities_temp_fishing)

allreg_dissimilarity_fishing_temp_mod_fishonly <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg + (1|survey_unit), data = dissimilarities_temp_fishing)

AICc(allreg_dissimilarity_fishing_temp_mod_1, allreg_dissimilarity_fishing_temp_mod_2,allreg_dissimilarity_fishing_temp_mod_3,allreg_dissimilarity_fishing_temp_mod_4,allreg_dissimilarity_fishing_temp_mod_5,allreg_dissimilarity_fishing_temp_mod_fishonly)

AICc(allreg_dissimilarity_fishing_temp_mod_1, allreg_dissimilarity_fishing_temp_mod_1.1,allreg_dissimilarity_fishing_temp_mod_fishonly)

#summary of best mod
summary(allreg_dissimilarity_fishing_temp_mod_1.1)

summary(allreg_dissimilarity_fishing_temp_mod_fishonly)
```
Significant predictors: 
summed_tonnes_scaled_byreg (as landings (proxy for fishing effort) increase, bray dissimilarity decreases)
sst_min_scaled (as the minimum annual temperature of the year before increases, bray dissimilarity increases)
summed_tonnes_scaled_byreg: sst_min_scaled (this interaction is not a significant predictor)

Mean Dissimilarity = 0.60 - 0.007 * scaled tonnes +  0.004 * sst_min_scaled

What about r^2 value
```{r}
r.squaredGLMM(allreg_dissimilarity_fishing_temp_mod_1.1)

#marginal GLMM (variance explained by fixed effects)
#conditional GLMM (variance explained by entire model)

#           R2m       R2c
#[1,] 0.00318718 0.8971907 (very little explained by fishing or temperature, most explained by survey_units)
```

#Plot temp only 

#Plot fishing only

allreg_dissimilarity_fishing_temp_mod_fishonly <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg + (1|survey_unit), data = dissimilarities_temp_fishing)

bray curtis dissimilarity = -0.005256 * tonnes + 0.6

```{r}
ggplot(data = dissimilarities_temp_fishing) +
  geom_point(aes(x=summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean)) +
  geom_smooth(aes(x=summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  theme_classic()

ggplot(data = dissimilarities_temp_fishing) +
  geom_point(aes(x=summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean)) +
  geom_smooth(aes(x=summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free")
  theme_classic()
  
 # ggsave(filename = "facet_fish_model.png", height = 10, width = 10, unit = "in")
  
  
  #sst_min_scaled
  
  ggplot(data = dissimilarities_temp_fishing) +
  geom_point(aes(x=sst_min_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit)) +
  geom_smooth(aes(x=sst_min_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), method = "lm", se = F) +
  theme_classic()
```




#CODE BELOW MAY NO LONGER BE RELEVANT
Plot this model with interaction
```{r}
library(interactions)
sim_slopes(allreg_dissimilarity_fishing_temp_mod_SDonly, pred = sst_SD_scaled, modx = summed_tonnes_scaled, johnson_neyman = FALSE)

interact_plot(allreg_dissimilarity_fishing_temp_mod_1, pred = yearly_min_bypoint_avg, modx = summed_tonnes_scaled_byreg, plot.points = T, colors = c("#b3ffe4","#00d68b","#003d28"), x.label = "Minimum Sea Surface Temperature", y.label = "Mean Annual Bray Curtis Dissimilarity") + theme_classic()

ggsave(filename = "interaction_fish_temp.png" ,height = 4, width = 10)

interact_plot(allreg_dissimilarity_fishing_temp_mod_SDonly, pred = sst_SD_scaled, modx = summed_tonnes_scaled, linearity.check = TRUE, 
              plot.points = TRUE) #check linearity 

```
Summary: (Doesn't make total sense)
-When fishing is average, higher standard deviation of temperature across a region means higher community dissimilarity 
-When fishing is high, higher standard deviation of temperature across a region means even higher community dissimilarity
-When fishing is low, higher standard deviation of temperature across a region means lower community dissimilarity



Zoom in on North Sea
```{r North Sea}

```





What about scaled for all regions?

```{r temp all regions but scaled}
#for all regions
allreg_dissimilarity_temperature_mean_scaled <- ggplot(data = distances_dissimilarities_allyears.r.temp) +
  labs(x = "Mean Annual SST Scaled",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = sst_mean_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values =  c("#5A5156","#E4E1E3","#F6222E","#FE00FA", 
  "#16FF32","#3283FE","#FEAF16","#B00068", 
  "#1CFFCE","#90AD1C","#2ED9FF","#DEA0FD", 
  "#AA0DFE","#F8A19F","#325A9B","#C4451C", 
  "#1C8356","#85660D","#B10DA1","#FBE426", 
  "#1CBE4F","#FA0087","#FC1CBF","#F7E1A0", 
  "#C075A6","#782AB6","#AAF400","#BDCDFF", 
  "#822E1C","#B5EFB5","#7ED7D1","#1C7F93", 
  "#D85FF7","#683B79","#66B0FF","#3B00FB")) +
  geom_smooth(aes(x = sst_mean_scaled, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(allreg_dissimilarity_temperature_mean_scaled, path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_mean_scaled.jpg", height = 4, width = 9, unit = "in")

#no legend
ggsave(allreg_dissimilarity_temperature_mean_scaled + theme(legend.position = "none"), path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_mean_scaled_nolegend.jpg", height = 4, width = 9, unit = "in") 

allreg_dissimilarity_temperature_mean_scaled_mod <- lmer(bray_curtis_dissimilarity_balanced_mean ~ sst_mean_scaled + (1|survey_unit), data = distances_dissimilarities_allyears.r.temp)

summary(allreg_dissimilarity_temperature_mean_scaled_mod)

#minimum all regions
allreg_dissimilarity_temperature_min_scaled <- ggplot(data = distances_dissimilarities_allyears.r.temp) +
  labs(x = "Minimum Annual SST Scaled",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_min_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = sst_min_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values =  c("#5A5156","#E4E1E3","#F6222E","#FE00FA", 
  "#16FF32","#3283FE","#FEAF16","#B00068", 
  "#1CFFCE","#90AD1C","#2ED9FF","#DEA0FD", 
  "#AA0DFE","#F8A19F","#325A9B","#C4451C", 
  "#1C8356","#85660D","#B10DA1","#FBE426", 
  "#1CBE4F","#FA0087","#FC1CBF","#F7E1A0", 
  "#C075A6","#782AB6","#AAF400","#BDCDFF", 
  "#822E1C","#B5EFB5","#7ED7D1","#1C7F93", 
  "#D85FF7","#683B79","#66B0FF","#3B00FB")) +
  geom_smooth(aes(x = sst_min_scaled, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(allreg_dissimilarity_temperature_min_scaled, path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_min_scaled.jpg", height = 4, width = 9, unit = "in") 

#no legend
ggsave(allreg_dissimilarity_temperature_min_scaled + theme(legend.position = "none"), path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_min_scaled_nolegend.jpg", height = 4, width = 9, unit = "in") 

allreg_dissimilarity_temperature_min_scaled_mod <- lmer(bray_curtis_dissimilarity_balanced_mean ~ sst_min_scaled + (1|survey_unit), data = distances_dissimilarities_allyears.r.temp)

summary(allreg_dissimilarity_temperature_min_scaled_mod)

#maximum for all regions
allreg_dissimilarity_temperature_max_scaled <- ggplot(data = distances_dissimilarities_allyears.r.temp) +
  labs(x = "Maximum Annual SST Scaled",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_max_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = sst_max_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values =  c("#5A5156","#E4E1E3","#F6222E","#FE00FA", 
  "#16FF32","#3283FE","#FEAF16","#B00068", 
  "#1CFFCE","#90AD1C","#2ED9FF","#DEA0FD", 
  "#AA0DFE","#F8A19F","#325A9B","#C4451C", 
  "#1C8356","#85660D","#B10DA1","#FBE426", 
  "#1CBE4F","#FA0087","#FC1CBF","#F7E1A0", 
  "#C075A6","#782AB6","#AAF400","#BDCDFF", 
  "#822E1C","#B5EFB5","#7ED7D1","#1C7F93", 
  "#D85FF7","#683B79","#66B0FF","#3B00FB")) +
  geom_smooth(aes(x = sst_max_scaled, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(allreg_dissimilarity_temperature_max_scaled, path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_max_scaled.jpg", height = 4, width = 9, unit = "in") 

#no legend
ggsave(allreg_dissimilarity_temperature_max_scaled + theme(legend.position = "none"), path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_max_scaled_nolegend.jpg", height = 4, width = 9, unit = "in") 

allreg_dissimilarity_temperature_max_scaled_mod <- lmer(bray_curtis_dissimilarity_balanced_mean ~ sst_max_scaled + (1|survey_unit), data = distances_dissimilarities_allyears.r.temp)

summary(allreg_dissimilarity_temperature_max_scaled_mod)

#SD all reg (not sure this makes sense scaled?)
allreg_dissimilarity_temperature_SD_scaled <- ggplot(data = distances_dissimilarities_allyears.r.temp) +
  labs(x = "SD of Annual SST Scaled",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_SD_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = sst_SD_scaled, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values =  c("#5A5156","#E4E1E3","#F6222E","#FE00FA", 
  "#16FF32","#3283FE","#FEAF16","#B00068", 
  "#1CFFCE","#90AD1C","#2ED9FF","#DEA0FD", 
  "#AA0DFE","#F8A19F","#325A9B","#C4451C", 
  "#1C8356","#85660D","#B10DA1","#FBE426", 
  "#1CBE4F","#FA0087","#FC1CBF","#F7E1A0", 
  "#C075A6","#782AB6","#AAF400","#BDCDFF", 
  "#822E1C","#B5EFB5","#7ED7D1","#1C7F93", 
  "#D85FF7","#683B79","#66B0FF","#3B00FB")) +
  geom_smooth(aes(x = sst_SD_scaled, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(allreg_dissimilarity_temperature_SD_scaled, path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_SD_scaled.jpg", height = 4, width = 9, unit = "in") 

#no legend
ggsave(allreg_dissimilarity_temperature_SD_scaled + theme(legend.position = "none"), path  = here::here("figures","distance_decay"), filename = "allreg_dissimilarity_temperature_SD_scaled_nolegend.jpg", height = 4, width = 9, unit = "in") 

allreg_dissimilarity_temperature_SD_scaled_mod <- lmer(bray_curtis_dissimilarity_balanced_mean ~ sst_SD_scaled + (1|survey_unit), data = distances_dissimilarities_allyears.r.temp)

summary(allreg_dissimilarity_temperature_SD_scaled_mod)
```

Zoomed in examples:
* No change in dissimilarity w temp gulf of mexico fall 
* Decrease in dissimilarity w temp in EBS
* Increase in dissimilarity w temp in GSL-S (this could easily be because sampling changes over time)
* Instead, I'll use NorthSea as example

GMEX FALL example
```{r zoom in on example regions gmex fall}

#for just Gulf of mexico fall 
GMEX_Fall_dissimilarity_temperature_mean <- ggplot(data = distances_dissimilarities_allyears.r.temp[survey_unit == "GMEX_Fall",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1", alpha = 0.8) +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

ggsave(GMEX_Fall_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "GMEX_Fall_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

GMEX_Fall_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean, data = distances_dissimilarities_allyears.r.temp[survey_unit == "GMEX_Fall",])

summary(GMEX_Fall_dissimilarity_temperature_mean_mod)
```

EBS

```{r zoom in on example regions ebs}

#for just ebs
EBS_dissimilarity_temperature_mean <- ggplot(data = distances_dissimilarities_allyears.r.temp[survey_unit == "EBS_NA",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", alpha = 0.8) +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

ggsave(EBS_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "EBS_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

EBS_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean, data = distances_dissimilarities_allyears.r.temp[survey_unit == "EBS_NA",])

summary(EBS_dissimilarity_temperature_mean_mod)
```

EBS

```{r zoom in on example regions ebs againn}

#for just ebs
EBS_dissimilarity_temperature_mean <- ggplot(data = distances_dissimilarities_allyears.r.temp[survey_unit == "EBS_NA",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", alpha = 0.8) +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

ggsave(EBS_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "EBS_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

EBS_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean, data = distances_dissimilarities_allyears.r.temp[survey_unit == "EBS_NA",])

summary(EBS_dissimilarity_temperature_mean_mod)
```

Full EBS to match below NS and SCS
```{r zoom in on example regions EBS}
#Independent trends over time

#dissimilarity over time
EBS_dissimilarity_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "Year",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE") +
  geom_line(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

#meantemp over time
EBS_mean_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "Year",  y = "Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_mean), color = "#3283FE") +
  geom_line(aes(x = year, y = sst_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

#SD temp over time
EBS_SD_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "Year",  y = "SD of Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_SD), color = "#3283FE") +
  geom_line(aes(x = year, y = sst_SD), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

#fishing over time
EBS_fishing_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "Year",  y = "Landings (tonnes)") +
  geom_point(aes(x = year, y = summed_tonnes), color = "#3283FE") +
  geom_line(aes(x = year, y = summed_tonnes), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

EBS_characteristics <- plot_grid(EBS_dissimilarity_time, EBS_mean_temp_time, EBS_SD_temp_time, EBS_fishing_time, ncol = 4, align = "hv")

ggsave(EBS_characteristics, path  = here::here("figures","distance_decay"), filename = "EBS_characteristics_merge.jpg", height = 2.5, width = 9, unit = "in") 

#plotting linear models
#for just ebs mean temp
EBS_dissimilarity_temperature_mean <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE") +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

EBS_dissimilarity_temperature_mean

ggsave(EBS_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "EBS_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

EBS_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean_scaled, data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",])

summary(EBS_dissimilarity_temperature_mean_mod)

#for just ebs SD
EBS_dissimilarity_temperature_SD <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "SD of Mean Temperature",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE") +
  geom_line(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

EBS_dissimilarity_temperature_SD

ggsave(EBS_dissimilarity_temperature_SD, path  = here::here("figures","distance_decay"), filename = "EBS_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

EBS_dissimilarity_temperature_SD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_SD, data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",])

summary(EBS_dissimilarity_temperature_SD_mod)

#for just ebs fishing
#for just ebs SD
EBS_dissimilarity_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",]) +
  labs(x = "Summed Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE") +
  geom_line(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#3283FE", stat="smooth", method = "lm") +
  theme_classic()

EBS_dissimilarity_fishing

ggsave(EBS_dissimilarity_fishing, path  = here::here("figures","distance_decay"), filename = "EBS_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

EBS_dissimilarity_fishing_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes, data = dissimilarities_temp_fishing[survey_unit == "EBS_NA",])

summary(EBS_dissimilarity_fishing_mod)

EBS <- plot_grid(EBS_dissimilarity_temperature_mean, EBS_dissimilarity_temperature_SD + theme(axis.title.y = element_blank()), EBS_dissimilarity_fishing +theme(axis.title.y = element_blank()), ncol = 3, align = "hv")

ggsave(EBS, path  = here::here("figures","distance_decay"), filename = "EBS_merge.jpg", height = 3, width = 9, unit = "in") 
```


North Sea

```{r zoom in on example regions northsea}
#Independent trends over time

#dissimilarity over time
NS_IBTS_dissimilarity_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "Year",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0") +
  geom_line(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

#meantemp over time
NS_IBTS_mean_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "Year",  y = "Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_mean), color = "#F7E1A0") +
  geom_line(aes(x = year, y = sst_mean), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

#SD temp over time
NS_IBTS_SD_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "Year",  y = "SD of Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_SD), color = "#F7E1A0") +
  geom_line(aes(x = year, y = sst_SD), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

#fishing over time
NS_IBTS_fishing_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "Year",  y = "Landings (tonnes)") +
  geom_point(aes(x = year, y = summed_tonnes), color = "#F7E1A0") +
  geom_line(aes(x = year, y = summed_tonnes), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

ns_ibts_characteristics <- plot_grid(NS_IBTS_dissimilarity_time, NS_IBTS_mean_temp_time, NS_IBTS_SD_temp_time, NS_IBTS_fishing_time, ncol = 4, align = "hv")

ggsave(ns_ibts_characteristics, path  = here::here("figures","distance_decay"), filename = "NS_ibts_characteristics_merge.jpg", height = 2.5, width = 9, unit = "in") 

#plotting linear models
#for just ebs mean temp
NS_IBTS_dissimilarity_temperature_mean <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0") +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

NS_IBTS_dissimilarity_temperature_mean

ggsave(NS_IBTS_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "NS_IBTS_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

NS_IBTS_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean_scaled, data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",])

summary(NS_IBTS_dissimilarity_temperature_mean_mod)

#for just ebs SD
NS_IBTS_dissimilarity_temperature_SD <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "SD of Mean Temperature",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0") +
  geom_line(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

NS_IBTS_dissimilarity_temperature_SD

ggsave(NS_IBTS_dissimilarity_temperature_SD, path  = here::here("figures","distance_decay"), filename = "NS_IBTS_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

NS_IBTS_dissimilarity_temperature_SD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_SD, data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",])

summary(NS_IBTS_dissimilarity_temperature_SD_mod)

#for just ebs fishing
#for just ebs SD
NS_IBTS_dissimilarity_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",]) +
  labs(x = "Summed Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0") +
  geom_line(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#F7E1A0", stat="smooth", method = "lm") +
  theme_classic()

NS_IBTS_dissimilarity_fishing

ggsave(NS_IBTS_dissimilarity_fishing, path  = here::here("figures","distance_decay"), filename = "NS_IBTS_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

NS_IBTS_dissimilarity_fishing_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes, data = dissimilarities_temp_fishing[survey_unit == "NS-IBTS_NA",])

summary(NS_IBTS_dissimilarity_fishing_mod)

ns_ibts <- plot_grid(NS_IBTS_dissimilarity_temperature_mean, NS_IBTS_dissimilarity_temperature_SD + theme(axis.title.y = element_blank()), NS_IBTS_dissimilarity_fishing +theme(axis.title.y = element_blank()), ncol = 3, align = "hv")

ggsave(ns_ibts, path  = here::here("figures","distance_decay"), filename = "NS_ibts_merge.jpg", height = 3, width = 9, unit = "in") 
```

Scotian Shelf

```{r zoom in on example regions scotian shelf}

#Independent trends over time

#dissimilarity over time
SCS_SUMMER_dissimilarity_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "Year",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C") +
  geom_line(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

#meantemp over time
SCS_SUMMER_mean_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "Year",  y = "Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_mean), color = "#822E1C") +
  geom_line(aes(x = year, y = sst_mean), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

#SD temp over time
SCS_SUMMER_SD_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "Year",  y = "SD of Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_SD), color = "#822E1C") +
  geom_line(aes(x = year, y = sst_SD), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

#fishing over time
SCS_SUMMER_fishing_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "Year",  y = "Landings (tonnes)") +
  geom_point(aes(x = year, y = summed_tonnes), color = "#822E1C") +
  geom_line(aes(x = year, y = summed_tonnes), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

SCS_SUMMER_characteristics <- plot_grid(SCS_SUMMER_dissimilarity_time, SCS_SUMMER_mean_temp_time, SCS_SUMMER_SD_temp_time, SCS_SUMMER_fishing_time, ncol = 4, align = "hv")

ggsave(SCS_SUMMER_characteristics, path  = here::here("figures","distance_decay"), filename = "SCS_SUMMER_characteristics_merge.jpg", height = 2.5, width = 9, unit = "in") 

#plotting linear models

#for just scs mean temp
SCS_SUMMER_dissimilarity_temperature_mean <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C") +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

SCS_SUMMER_dissimilarity_temperature_mean

ggsave(SCS_SUMMER_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "SCS_SUMMER_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

SCS_SUMMER_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean_scaled, data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",])

summary(SCS_SUMMER_dissimilarity_temperature_mean_mod)

#for just ebs SD
SCS_SUMMER_dissimilarity_temperature_SD <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "SD of Mean Temperature",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C") +
  geom_line(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

SCS_SUMMER_dissimilarity_temperature_SD

ggsave(SCS_SUMMER_dissimilarity_temperature_SD, path  = here::here("figures","distance_decay"), filename = "SCS_SUMMER_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

SCS_SUMMER_dissimilarity_temperature_SD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_SD, data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",])

summary(SCS_SUMMER_dissimilarity_temperature_SD_mod)

#for just ebs fishing
#for just ebs SD
SCS_SUMMER_dissimilarity_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",]) +
  labs(x = "Summed Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C") +
  geom_line(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#822E1C", stat="smooth", method = "lm") +
  theme_classic()

SCS_SUMMER_dissimilarity_fishing

ggsave(SCS_SUMMER_dissimilarity_fishing, path  = here::here("figures","distance_decay"), filename = "SCS_SUMMER_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

SCS_SUMMER_dissimilarity_fishing_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes, data = dissimilarities_temp_fishing[survey_unit == "SCS_SUMMER",])

summary(SCS_SUMMER_dissimilarity_fishing_mod)

library(cowplot)
scs_merge <- plot_grid(SCS_SUMMER_dissimilarity_temperature_mean, SCS_SUMMER_dissimilarity_temperature_SD + theme(axis.title.y = element_blank()), SCS_SUMMER_dissimilarity_fishing +theme(axis.title.y = element_blank()), ncol = 3, align = "hv")

ggsave(scs_merge, path  = here::here("figures","distance_decay"), filename = "scs_merge.jpg", height = 3, width = 9, unit = "in") 
```

Irish Sea: IE-IGFS_NA Irish Sea

```{r zoom in on example regions irish sea}

#Independent trends over time

#dissimilarity over time
IE_IGFS_NA_dissimilarity_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "Year",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C") +
  geom_line(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

#meantemp over time
IE_IGFS_NA_mean_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "Year",  y = "Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_mean), color = "#C4451C") +
  geom_line(aes(x = year, y = sst_mean), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

#SD temp over time
IE_IGFS_NA_SD_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "Year",  y = "SD of Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_SD), color = "#C4451C") +
  geom_line(aes(x = year, y = sst_SD), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

#fishing over time
IE_IGFS_NA_fishing_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "Year",  y = "Landings (tonnes)") +
  geom_point(aes(x = year, y = summed_tonnes), color = "#C4451C") +
  geom_line(aes(x = year, y = summed_tonnes), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

IE_IGFS_NA_characteristics <- plot_grid(IE_IGFS_NA_dissimilarity_time, IE_IGFS_NA_mean_temp_time, IE_IGFS_NA_SD_temp_time, IE_IGFS_NA_fishing_time, ncol = 4, align = "hv")

ggsave(IE_IGFS_NA_characteristics, path  = here::here("figures","distance_decay"), filename = "IE_IGFS_NA_characteristics_merge.jpg", height = 2.5, width = 9, unit = "in") 

#plotting linear models

#for just scs mean temp
IE_IGFS_NA_dissimilarity_temperature_mean <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C") +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

IE_IGFS_NA_dissimilarity_temperature_mean

ggsave(IE_IGFS_NA_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "IE_IGFS_NA_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

IE_IGFS_NA_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean_scaled, data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",])

summary(IE_IGFS_NA_dissimilarity_temperature_mean_mod)

#for just ebs SD
IE_IGFS_NA_dissimilarity_temperature_SD <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "SD of Mean Temperature",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C") +
  geom_line(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

IE_IGFS_NA_dissimilarity_temperature_SD

ggsave(IE_IGFS_NA_dissimilarity_temperature_SD, path  = here::here("figures","distance_decay"), filename = "IE_IGFS_NA_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

IE_IGFS_NA_dissimilarity_temperature_SD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_SD, data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",])

summary(IE_IGFS_NA_dissimilarity_temperature_SD_mod)

#for just ebs fishing
#for just ebs SD
IE_IGFS_NA_dissimilarity_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",]) +
  labs(x = "Summed Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C") +
  geom_line(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#C4451C", stat="smooth", method = "lm") +
  theme_classic()

IE_IGFS_NA_dissimilarity_fishing

ggsave(IE_IGFS_NA_dissimilarity_fishing, path  = here::here("figures","distance_decay"), filename = "IE_IGFS_NA_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

IE_IGFS_NA_dissimilarity_fishing_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes, data = dissimilarities_temp_fishing[survey_unit == "IE-IGFS_NA",])

summary(IE_IGFS_NA_dissimilarity_fishing_mod)

library(cowplot)
IE_IFGS_merge <- plot_grid(IE_IGFS_NA_dissimilarity_temperature_mean, IE_IGFS_NA_dissimilarity_temperature_SD + theme(axis.title.y = element_blank()), IE_IGFS_NA_dissimilarity_fishing +theme(axis.title.y = element_blank()), ncol = 3, align = "hv")

ggsave(IE_IFGS_merge, path  = here::here("figures","distance_decay"), filename = "IE_IFGS_merge.jpg", height = 3, width = 9, unit = "in") 
```

Gulf of Mexico

```{r zoom in on example regions gmex fall }

#Independent trends over time

#dissimilarity over time
GMEX_Fall_dissimilarity_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "Year",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1") +
  geom_line(aes(x = year, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

#meantemp over time
GMEX_Fall_mean_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "Year",  y = "Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_mean), color = "#7ED7D1") +
  geom_line(aes(x = year, y = sst_mean), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

#SD temp over time
GMEX_Fall_SD_temp_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "Year",  y = "SD of Mean Annual SST (˚C)") +
  geom_point(aes(x = year, y = sst_SD), color = "#7ED7D1") +
  geom_line(aes(x = year, y = sst_SD), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

#fishing over time
GMEX_Fall_fishing_time <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "Year",  y = "Landings (tonnes)") +
  geom_point(aes(x = year, y = summed_tonnes), color = "#7ED7D1") +
  geom_line(aes(x = year, y = summed_tonnes), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

GMEX_Fall_characteristics <- plot_grid(GMEX_Fall_dissimilarity_time, GMEX_Fall_mean_temp_time, GMEX_Fall_SD_temp_time, GMEX_Fall_fishing_time, ncol = 4, align = "hv")

ggsave(GMEX_Fall_characteristics, path  = here::here("figures","distance_decay"), filename = "GMEX_Fall_characteristics_merge.jpg", height = 2.5, width = 9, unit = "in") 

#plotting linear models

#for just scs mean temp
GMEX_Fall_dissimilarity_temperature_mean <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "Mean Annual SST (˚C)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1") +
  geom_line(aes(x = sst_mean, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

GMEX_Fall_dissimilarity_temperature_mean

ggsave(GMEX_Fall_dissimilarity_temperature_mean, path  = here::here("figures","distance_decay"), filename = "GMEX_Fall_dissimilarity_temperature_mean.jpg", height = 3, width = 4, unit = "in") 

GMEX_Fall_dissimilarity_temperature_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_mean_scaled, data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",])

summary(GMEX_Fall_dissimilarity_temperature_mean_mod)

#for just ebs SD
GMEX_Fall_dissimilarity_temperature_SD <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "SD of Mean Temperature",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1") +
  geom_line(aes(x = sst_SD, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

GMEX_Fall_dissimilarity_temperature_SD

ggsave(GMEX_Fall_dissimilarity_temperature_SD, path  = here::here("figures","distance_decay"), filename = "GMEX_Fall_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

GMEX_Fall_dissimilarity_temperature_SD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ sst_SD, data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",])

summary(GMEX_Fall_dissimilarity_temperature_SD_mod)

#for just ebs fishing
#for just ebs SD
GMEX_Fall_dissimilarity_fishing <- ggplot(data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",]) +
  labs(x = "Summed Landings (tonnes)",  y = "Average Bray Curtis Dissimilarity") +
  geom_point(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1") +
  geom_line(aes(x = summed_tonnes, y = bray_curtis_dissimilarity_balanced_mean), color = "#7ED7D1", stat="smooth", method = "lm") +
  theme_classic()

GMEX_Fall_dissimilarity_fishing

ggsave(GMEX_Fall_dissimilarity_fishing, path  = here::here("figures","distance_decay"), filename = "GMEX_Fall_dissimilarity_temperature_SD.jpg", height = 3, width = 4, unit = "in") 

GMEX_Fall_dissimilarity_fishing_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes, data = dissimilarities_temp_fishing[survey_unit == "GMEX_Fall",])

summary(GMEX_Fall_dissimilarity_fishing_mod)

library(cowplot)
GMEX_Fall_merge <- plot_grid(GMEX_Fall_dissimilarity_temperature_mean, GMEX_Fall_dissimilarity_temperature_SD + theme(axis.title.y = element_blank()), GMEX_Fall_dissimilarity_fishing +theme(axis.title.y = element_blank()), ncol = 3, align = "hv")

ggsave(GMEX_Fall_merge, path  = here::here("figures","distance_decay"), filename = "GMEX_Fall_merge.jpg", height = 3, width = 9, unit = "in") 
```
