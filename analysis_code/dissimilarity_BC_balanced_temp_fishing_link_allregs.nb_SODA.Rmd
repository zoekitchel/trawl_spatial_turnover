---
title: "Bray Balanced Dissimilarity Bottom Temperature & Fishing Interactions for All Regions"
output: html_notebook
---

Here we will link temperature and fishing to dissimilarity

This code is Script X for Kitchel et al. TITLE manuscript.

- This project is a collaborative effort to describe changes in taxonomic composition  of fish communities around the world--as sampled by bottom tscaledl surveys.

- Code by ZoÃ« J. Kitchel

SESSION INFO TO DO

##Here, we examine bottom temperature and fishing pressure to predict annual BC balanced dissimilarity for all survey units


```{r setup}

library(data.table)
library(ggplot2)
library(lme4)
library(lmerTest)
library(MuMIn)


SODA_data_temp_avgs_full <- readRDS(here::here("data","Temperature","SODA_data_temp_avgs_full.rds"))
#don't feel confident about SODA temp before 1980 right now, start then

SODA_data_temp_avgs_full <- SODA_data_temp_avgs_full[year_for_avg >= 1980,]

SODA_data_temp_avgs_full[,year := year_for_avg]


#pull in average distance decay values
distances_dissimilarities_allyears.r <- readRDS(here::here("output","distance_decay","distances_dissimilarities_allyears.r.rds"))

#pull in fishing data
SAU_summed_tonnes.r <- readRDS(here::here("data","sea_around_us","SAU_summed_tonnes.rds"))

#pull in regional statistics
region_stats <- readRDS(here::here("output","region_stats", "region_stats.rds"))

#year by year gamma diversity and other stats
FishGlob_richness_year_survey <- readRDS(file = here::here("output","FishGlob_richness_year_survey.Rds"))


```

Put into one data table
```{r link temp and fishing to avg values}
#temp
distances_dissimilarities_allyears.r.temp <- SODA_data_temp_avgs_full[distances_dissimilarities_allyears.r, on = c("year","survey_unit")]

#fishing
dissimilarities_temp_fishing <- SAU_summed_tonnes.r[distances_dissimilarities_allyears.r.temp, on = c("year", "survey_unit")]

#region_statistics
dissimilarities_temp_fishing_regstats <- dissimilarities_temp_fishing[region_stats, on = "survey_unit"]
dissimilarities_temp_fishing_regstats[,spp_num.s := scale(spp_num)]

dissimilarities_temp_fishing_regstats[,bray_curtis_dissimilarity_balanced_mean.s := scale(bray_curtis_dissimilarity_balanced_mean, center = F),survey_unit]

dissimilarities_temp_fishing_regstats <- dissimilarities_temp_fishing_regstats[FishGlob_richness_year_survey, on = c("year","survey_unit")]

dissimilarities_temp_fishing_regstats[,spp_count_annual.s := scale(spp_count_annual)]

#save avg values
saveRDS(dissimilarities_temp_fishing_regstats, here::here("output","distance_decay","dissimilarities_temp_fishing_regstats.rds"))
```

Color pallete for survey units
```{r}

survey_unit.list <- levels(region_stats[,factor(survey_unit)])

pal_37 <- c(
  "#5A5156", #AI
  "#F6222E", #CHL
  "#F8A19F", #DFO-NF
  "#16FF32", #DFO-QCS
  "#DF00DB", #BITS-1
  "#DB8EDA", #BITS-4
  "#325A9B", #EBS
  "#3283FE", #EVHOE
  "#FEAF16", #FR-CGFS
  "#1C8356", #GMEX-Summer
  "#C4451C", #GOA
  "#85660D", #GRL-DE
  "#B0009F", #GSL-N
  "#BF79B8", #GSL-S
  "#1CBE4F", #ICE-GFS
  "#782AB6", #IE-IGFS
  "#90AD1C", #MEDITS
  "#6B003A", #NAM
  "#A75B00", #NEUS-Fall
  "#E3B072", #NEUS-Spring
  "#02E8B6", #NIGFS-1
  "#97E7D5", #NIGFS-4
  "#B00068", #Nor-BTS-3
  "#00B9E3", #NS-IBTS-1
  "#95E2F4", #NS-IBTS-3
  "#B3CE73", #NZ-CHAT
  "#689500", #NZ-ECSI
  "#AAF400", #NZ-WCSI
  "#AA0DFE", #PT-IBTS
  "#FA0087", #S-GEORG
  "#DEA0FD", #SCS-Summer
  "#FCEF88", #SEUS-fall
  "#A59405", #SEUS-spring
  "#FCE100", #SEUS-summer
  "#C075A6", #WCANN
  "#BDCDFF", #ZAF-ATL
  "#003EFF")  #ZAF-IND
  
color_link <- data.table(survey_unit = survey_unit.list,hex = pal_37)
```

Add names for plotting
```{r add names for plotting}


name_helper <- data.table(Survey_Name_Season = c("Aleutian Islands",
                                    "Baltic Sea Q1",
                                    "Baltic Sea Q4",
                                    "Chile",
                                    "Newfoundland",
                                    "Queen Charlotte Sound",
                                    "Eastern Bering Sea",
                                    "Bay of Biscay",
                                    "English Channel",
                                    "Gulf of Mexico",
                                    "Gulf of Alaska",
                                    "Greenland",
                                    "N Gulf of St. Lawrence",
                                    "S Gulf of St. Lawrence",
                                    "Iceland",
                                    "Irish Sea",
                                    "Mediterranean",
                                    "Namibia",
                                    "NE US Fall",
                                    "NE US Spring",
                                    "N Ireland Q1",
                                    "N Ireland Q4",
                                    "Norway",
                                    "N Sea Q1",
                                    "N Sea Q3",
                                    "Chatham Rise",
                                    "E Coast S Island NZ",
                                    "W Coast S Island NZ",
                                    "Portugal",
                                    "S Georgia Straight",
                                  "Scotian Shelf",
                                  "SE US Fall",
                                  "SE US Spring",
                                  "SE US Summer",
                                  "W Coast US",
                                  "Atlantic Ocean ZA",
                                  "Indian Ocean ZA"),
                          survey_unit = c(
                                  "AI",        
                                  "BITS-1",    
                                  "BITS-4",    
                                  "CHL",       
                                  "DFO-NF",    
                                  "DFO-QCS",   
                                  "EBS",       
                                  "EVHOE",     
                                  "FR-CGFS",   
                                  "GMEX-Summer",
                                  "GOA",       
                                  "GRL-DE",    
                                  "GSL-N",     
                                  "GSL-S",     
                                  "ICE-GFS",   
                                  "IE-IGFS",   
                                  "MEDITS",    
                                  "NAM",       
                                  "NEUS-Fall", 
                                  "NEUS-Spring",
                                  "NIGFS-1",   
                                  "NIGFS-4",   
                                  "Nor-BTS-3", 
                                  "NS-IBTS-1", 
                                  "NS-IBTS-3", 
                                  "NZ-CHAT",   
                                  "NZ-ECSI",   
                                  "NZ-WCSI",   
                                  "PT-IBTS",   
                                  "S-GEORG",   
                                  "SCS-SUMMER",
                                  "SEUS-fall", 
                                  "SEUS-spring",
                                  "SEUS-summer",
                                  "WCANN",     
                                  "ZAF-ATL",   
                                  "ZAF-IND"   
                          ))

color_link <- color_link[name_helper, on = "survey_unit"]

```

Table that will be populated with model results
```{r}
#depth, scaled, temp var, coefficient, p-value, marg_r^2, cond_r^2, AICc
balanced_dissimilarity_sbt_fishing_model_results <- data.table(Depth = as.character(),
                                                       Scaled = as.character(),
                                                       `Temp variable` = as.character(),
                                                       `Fishing`= as.character(),
                                                       `Temp fishing interaction` = as.character(),
                                                       `Fixed effect structure` = as.character(),
                                                       `Mixed effect structure` = as.character(),
                                                       Intercept = as.numeric(),
                                                       `Temp coefficient` = as.numeric(),
                                                       `Coefficient p-value 1` = as.numeric(),
                                                       `Fishing coefficient` = as.numeric(),
                                                       `Coefficient p-value 2` = as.numeric(),
                                                       `Temp*fishing coefficient` = as.numeric(),
                                                       `Coefficient p-value 3` = as.numeric(),
                                                       `Marginal R-squared` = as.numeric(),
                                                       `Conditional R-squared` = as.numeric(),
                                                       AICc = as.numeric(),
                                                       `Degrees of freedom`=as.numeric())
                                                  
```

###How well does fishing alone predict mean annual BC balanced dissimilarity?
(Note this code is identical to dissimilarity_BC_balanced_temp_fishing_link_allregs.nb_OISST.Rmd between here and ~line 249, but I've kept it in to allow easier model comparisons. Edits will need to be made in both places)
```{r build fishing mod}

#fishing and random slope and intercept for survey
allreg_dissimilarity_fishing_mean_mod <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#random slope and intercept for survey no fishing
allreg_dissimilarity.intercept_slope <- lmer(bray_curtis_dissimilarity_balanced_mean ~ (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity.intercept_slope)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            NA, #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity.intercept_slope)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity.intercept_slope)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity.intercept_slope),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#fishing and survey random intercept only
allreg_dissimilarity_fishing_mean_mod.intercept <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod.intercept)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg", #fixed effect
                                                            "1|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod.intercept)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod.intercept)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod.intercept),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#random intercept only
allreg_dissimilarity.intercept <- lmer(bray_curtis_dissimilarity_balanced_mean ~  (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity.intercept)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            NA, #fixed effect
                                                            "1|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity.intercept)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity.intercept)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity.intercept),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#fixed effect for survey and interaction with fishing
allreg_dissimilarity_fishing_fixed_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*survey_unit, data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_fixed_mean_mod)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*survey_unit", #fixed effect
                                                            NA, #mixed effect                                               
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_fixed_mean_mod)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_fixed_mean_mod)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_fixed_mean_mod),3),#AICc
                                                            684 #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#fixed effect for survey and fishing, no interaction
allreg_dissimilarity_fishing_fixed_mean_mod_nointer <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+survey_unit, data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_fixed_mean_mod_nointer)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg+survey_unit", #fixed effect
                                                            NA, #mixed effect                                                            
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_fixed_mean_mod_nointer)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_fixed_mean_mod_nointer)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_fixed_mean_mod_nointer),3),#AICc
                                                            720 #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#fixed effect for survey only
allreg_dissimilarity_survey_fixed_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ survey_unit, data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity_survey_fixed_mod)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "survey_unit", #fixed effect
                                                            NA, #mixed effect                                                           
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_survey_fixed_mod)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_survey_fixed_mod)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_survey_fixed_mod),3),#AICc
                                                            757 #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#no effect for survey, fishing as fixed effect
allreg_dissimilarity_fishing_mean_mod_lm <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg, data = dissimilarities_temp_fishing_regstats)

coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_lm)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c(NA, #depth
                                                            NA, #scaled
                                                            NA, #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg", #fixed effect
                                                            NA, #mixed effect                                                          
                                                            round(coefs[1,1],3), #intercept
                                                            NA,#temp coef
                                                            NA,#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_lm)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_lm)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_lm),3),#AICc
                                                            756 #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#In years of higher than average fishing pressure, dissimilarity is lower (homogenization), except for when we include fixed effects for both fishing and survey, in which case the slope is positive. 


View(balanced_dissimilarity_sbt_fishing_model_results)

#save fishing only output
balanced_dissimilarity_fishing_model_results <- balanced_dissimilarity_sbt_fishing_model_results

saveRDS(balanced_dissimilarity_fishing_model_results, here::here("output","balanced_dissimilarity_fishing_model_results.Rds"))

```
Best model includes only survey unit as a fixed effect. Second best model includes an interaction between fishing and survey unit.

As relative fishing pressure increases, dissimilarity decreases (more fished communities = more homogenized communities). However, this varies a long among regions.

####Plot Fishing Only Model
```{r plot fishing vs dissimilarity}
dissimilarities_temp_fishing_regstats.na <- na.omit(dissimilarities_temp_fishing_regstats, cols = "summed_tonnes_scaled_byreg") #delete any rows with NAs

#Predicted values
dissimilarities_temp_fishing_regstats.na$pred_summed_tonnes_scaled_byreg <- predict(allreg_dissimilarity_fishing_mean_mod,re.form=NA)  ## population level
dissimilarities_temp_fishing_regstats.na$pred_summed_tonnes_scaled_byreg_individual <- predict(allreg_dissimilarity_fishing_mean_mod) ## individual level

#confidence intervals
fishing_confit <- confint(allreg_dissimilarity_fishing_mean_mod, oldNames = F)

#upper lower bounds from confidence intervals
dissimilarities_temp_fishing_regstats.na[,pred_summed_tonnes_scaled_byreg_lwr := fishing_confit[5,1] + fishing_confit[6,1]*summed_tonnes_scaled_byreg]#lower confidence interval
dissimilarities_temp_fishing_regstats.na[,pred_summed_tonnes_scaled_byreg_upr := fishing_confit[5,2] + fishing_confit[6,2]*summed_tonnes_scaled_byreg]#upper confidence interval


#for all regions
(allreg_BC_balanced_dissimilarity_fishing_mean <- ggplot(data = dissimilarities_temp_fishing_regstats.na) +
  labs(x = "Relative fishing pressure",  y = "BC balanced dissimilarity") +
  geom_point(aes(x = summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = summed_tonnes_scaled_byreg, y = pred_summed_tonnes_scaled_byreg_individual, color = survey_unit)) +
  geom_line(aes(x = summed_tonnes_scaled_byreg, y = pred_summed_tonnes_scaled_byreg), lwd = 1) +
  scale_color_manual(values =  pal_37) +
  theme_classic())

#save
ggsave(allreg_BC_balanced_dissimilarity_fishing_mean, path = here::here("figures","predictor_variables"), filename = "allreg_BC_balanced_dissimilarity_fishing_mean.jpg")

#for all regions faceted
(allreg_BC_balanced_dissimilarity_fishing_mean_facet <- ggplot(data = dissimilarities_temp_fishing_regstats.na) +
  labs(x = "Relative fishing pressure",  y = "BC balanced dissimilarity") +
  geom_point(aes(x = summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = summed_tonnes_scaled_byreg, y = pred_summed_tonnes_scaled_byreg_individual, color = survey_unit)) +
  scale_color_manual(values =  pal_37) +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic() +
    theme(legend.position = "null"))

#save
ggsave(allreg_BC_balanced_dissimilarity_fishing_mean_facet, path = here::here("figures","predictor_variables"), filename = "allreg_BC_balanced_dissimilarity_fishing_mean_facet.jpg", height = 8, width = 12, unit = "in")

#all one color points
(allreg_BC_balanced_dissimilarity_fishing_mean_SIMPLIFIED <- ggplot(data = dissimilarities_temp_fishing_regstats.na) +
  labs(x = "Relative fishing pressure",  y = "Dissimilarity") +
  geom_point(aes(x = summed_tonnes_scaled_byreg, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_line(aes(x = summed_tonnes_scaled_byreg, y = pred_summed_tonnes_scaled_byreg)) +
  geom_ribbon(aes(x = summed_tonnes_scaled_byreg, ymin = pred_summed_tonnes_scaled_byreg_lwr, ymax = pred_summed_tonnes_scaled_byreg_upr), alpha = 0.2) +
  theme_classic())

#save
ggsave(allreg_BC_balanced_dissimilarity_fishing_mean_SIMPLIFIED, path = here::here("figures","predictor_variables"), filename = "allreg_BC_balanced_dissimilarity_fishing_mean_SIMPLIFIED.jpg")
```


###Temperature x fishing models
Best temp variables to carry forward: 

For scaled temp (indicative of survey vs. survey):
-Mean temperature
-SD of mean temp


For scaled temp (indicative of within survey: cool or warm year? heterogenous or homogenous year comparatively?)
-Scaled mean temp

Starting with survey unit as random slope~fishing pressure and intercept

Mean temp
```{r mean temp and fishing models of dissimilarity}
#raw mean temp values

#fishing and temperature interaction
allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            round(coefs[4,1],3), #interact coef
                                                            round(coefs[4,5],3), #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#fishing and temperature interaction, random intercept not random slope
allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg", #fixed effect
                                                            "1|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            round(coefs[4,1],3), #interact coef
                                                            round(coefs[4,5],3), #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#raw temp values AND interaction with both fishing and fixed survey unit

allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_two_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_two_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                           "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            round(coefs[40,1],3), #interact coef (fishing and temp)
                                                            round(coefs[40,4],3), #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_two_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_two_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_two_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_two_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interaction with fishing but not fixed survey unit

allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_fish_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_fish_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg+survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            round(coefs[40,1],3), #interact coef (fishing and temp)
                                                            round(coefs[40,4],3), #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_fish_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_fish_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_fish_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_fish_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interact with survey unit but no interact with fishing

allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_survey_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_survey_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                          "summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_survey_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_survey_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_survey_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_temp_survey_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interact with survey unit but no interact with fishing

allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_survey_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~yearly_mean_bypoint_avg + summed_tonnes_scaled_byreg*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_survey_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg + summed_tonnes_scaled_byreg*survey_unit", #fixed effect
                                                            NA, #mixed effect                                                            
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_survey_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_survey_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_survey_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_survey_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values, fixed effects for fishing and survey unit, no interact

allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_no_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~yearly_mean_bypoint_avg + summed_tonnes_scaled_byreg + survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_no_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg + summed_tonnes_scaled_byreg + survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_no_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_no_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_no_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_fixed_fishing_no_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
 

#scaled temp and fishing but, no interaction, random slope and intercept 
  allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg.nointeract <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

  
          coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg.nointeract)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg.nointeract)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg.nointeract)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg.nointeract),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
    
  #scaled temp only
  allreg_dissimilarity_mod_sbt_mean_avg <- lmer(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

  
               coefs <- data.frame(coef(summary(allreg_dissimilarity_mod_sbt_mean_avg)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_mod_sbt_mean_avg)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_mod_sbt_mean_avg)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_mod_sbt_mean_avg),3),#AICc
                                                           NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#temp only with interaction with fixed effect with survey unit

allreg_dissimilarity_sbt_mean_avg_fixed <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_sbt_mean_avg_fixed)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_sbt_mean_avg_fixed),3),#AICc
                                                            summary(allreg_dissimilarity_sbt_mean_avg_fixed)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#temp only with fixed effect with survey unit, no interact

allreg_dissimilarity_sbt_mean_avg_fixed_nointeract <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg+survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract),3),#AICc
                                  summary(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)$df[2]) #degrees of freedom 
                                                            ,nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
    

```

SD of Mean temp
```{r SD of mean temp and fishing models of dissimilarity}
#raw mean temp values

#fishing and temperature interaction
allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            round(coefs[4,1],3), #interact coef
                                                            round(coefs[4,5],3), #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#fishing and temperature interaction, random intercept not random slope
allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_surveyunitrandomslopeonly <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_surveyunitrandomslopeonly)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD", #fixed effect
                                                            "1|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            round(coefs[4,1],3), #interact coef
                                                            round(coefs[4,5],3), #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_surveyunitrandomslopeonly)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_surveyunitrandomslopeonly)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_surveyunitrandomslopeonly),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#raw temp values AND interaction with both fishing and fixed survey unit

allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_two_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_two_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                           "summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            round(coefs[40,1],3), #interact coef (fishing and temp)
                                                            round(coefs[40,4],3), #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_two_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_two_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_two_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_two_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interaction with fishing but not fixed survey unit

allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_fish_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_fish_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_SD+survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            round(coefs[40,1],3), #interact coef (fishing and temp)
                                                            round(coefs[40,4],3), #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_fish_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_fish_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_fish_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_fish_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interact with survey unit but no interact with fishing

allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_survey_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+yearly_mean_bypoint_SD*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_survey_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                          "summed_tonnes_scaled_byreg+yearly_mean_bypoint_SD*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_survey_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_survey_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_survey_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_temp_survey_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interact with survey unit but no interact with fishing

allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_survey_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~yearly_mean_bypoint_SD + summed_tonnes_scaled_byreg*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_survey_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_SD + summed_tonnes_scaled_byreg*survey_unit", #fixed effect
                                                            NA, #mixed effect                                                            
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_survey_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_survey_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_survey_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_survey_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values, fixed effects for fishing and survey unit, no interact

allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_no_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~yearly_mean_bypoint_SD + summed_tonnes_scaled_byreg + survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_no_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_SD + summed_tonnes_scaled_byreg + survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_no_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_no_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_no_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD_fixed_fishing_no_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
 

#scaled temp and fishing but, no interaction, random slope and intercept 
  allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD.nointeract <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+yearly_mean_bypoint_SD + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

  
          coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD.nointeract)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg+yearly_mean_bypoint_SD", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD.nointeract)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD.nointeract)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_SD.nointeract),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
    
  #scaled temp only
  allreg_dissimilarity_mod_sbt_mean_SD <- lmer(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_SD + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

  
               coefs <- data.frame(coef(summary(allreg_dissimilarity_mod_sbt_mean_SD)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_SD", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_mod_sbt_mean_SD)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_mod_sbt_mean_SD)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_mod_sbt_mean_SD),3),#AICc
                                                           NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#temp only with interaction with fixed effect with survey unit

allreg_dissimilarity_sbt_mean_SD_fixed <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_SD*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_sbt_mean_SD_fixed)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_SD*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_SD_fixed)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_SD_fixed)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_sbt_mean_SD_fixed),3),#AICc
                                                            summary(allreg_dissimilarity_sbt_mean_SD_fixed)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#temp only with fixed effect with survey unit, no interact

allreg_dissimilarity_sbt_mean_SD_fixed_nointeract <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_SD+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_sbt_mean_SD_fixed_nointeract)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            F, #scaled
                                                            "SD of mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_SD+survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_SD_fixed_nointeract)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_SD_fixed_nointeract)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_sbt_mean_SD_fixed_nointeract),3),#AICc
                                  summary(allreg_dissimilarity_sbt_mean_SD_fixed_nointeract)$df[2]) #degrees of freedom 
                                                            ,nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
    

```



Scaled mean temp values with fishing
```{r scaled mean temp values with fishing}
#scaled temp values

#fishing and temperature interaction
allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg.s + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg.s", #fixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            round(coefs[4,1],3), #interact coef
                                                            round(coefs[4,5],3), #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interaction with both fishing and fixed survey unit

allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_two_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg.s*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_two_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg.s*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            round(coefs[40,1],3), #interact coef (fishing and temp)
                                                            round(coefs[40,4],3), #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_two_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_two_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_two_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_two_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interaction with fishing but not fixed survey unit

allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_fish_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg.s+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_fish_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            T, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg.s+survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            round(coefs[40,1],3), #interact coef (fishing and temp)
                                                            round(coefs[40,4],3), #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_fish_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_fish_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_fish_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_fish_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interact with survey unit but no interact with fishing

allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_survey_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg.s*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_survey_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg.s*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_survey_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_survey_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_survey_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_temp_survey_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values AND interact with survey unit but no interact with fishing

allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_survey_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~yearly_mean_bypoint_avg.s + summed_tonnes_scaled_byreg*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_survey_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg.s + summed_tonnes_scaled_byreg*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_survey_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_survey_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_survey_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_survey_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#scaled temp values, fixed effects for fishing and survey unit, no interact

allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_no_interact <- lm(bray_curtis_dissimilarity_balanced_mean ~yearly_mean_bypoint_avg.s + summed_tonnes_scaled_byreg+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_no_interact)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg.s + summed_tonnes_scaled_byreg+survey_unit", #mixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,4],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_no_interact)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_no_interact)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_no_interact),3),#AICc
                                                            summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg_fixed_fishing_no_interact)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
 

#scaled temp and fishing but, no interaction, random slope and intercept 
  allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg.nointeract <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg.s + (1 + summed_tonnes_scaled_byreg|survey_unit), data = dissimilarities_temp_fishing_regstats)

  
          coefs <- data.frame(coef(summary(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg.nointeract)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            T, #fishing
                                                            F, #temp fishing interaction
                                                            "summed_tonnes_scaled_byreg+yearly_mean_bypoint_avg.s", #mixed effect
                                                            "1 + summed_tonnes_scaled_byreg|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[3,1],3),#temp coef
                                                            round(coefs[3,5],3),#coef p value
                                                            round(coefs[2,1],3),#fishing coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg.nointeract)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg.nointeract)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_fishing_mean_mod_sbt_scaled_mean_avg.nointeract),3),#AICc
                                                            NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
    
  #scaled temp only
  allreg_dissimilarity_mod_sbt_scaled_mean_avg <- lmer(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg.s + (1 + yearly_mean_bypoint_avg.s|survey_unit), data = dissimilarities_temp_fishing_regstats)

  
               coefs <- data.frame(coef(summary(allreg_dissimilarity_mod_sbt_scaled_mean_avg)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg.s", #mixed effect
                                                            "1 + yearly_mean_bypoint_avg.s|survey_unit", #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,5],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef
                                                            NA, #coef p value
                                                round(r.squaredGLMM(allreg_dissimilarity_mod_sbt_scaled_mean_avg)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_mod_sbt_scaled_mean_avg)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_mod_sbt_scaled_mean_avg),3),#AICc
                                                           NA #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#temp only with interaction with fixed effect with survey unit

allreg_dissimilarity_sbt_mean_avg_fixed <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg.s*survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_sbt_mean_avg_fixed)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg.s*survey_unit", #fixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_sbt_mean_avg_fixed),3),#AICc
                                                            summary(allreg_dissimilarity_sbt_mean_avg_fixed)$df[2] #degrees of freedom 
                                                            ),nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)

#temp only with fixed effect with survey unit, no interact

allreg_dissimilarity_sbt_mean_avg_fixed_nointeract <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg.s+survey_unit, data = dissimilarities_temp_fishing_regstats)


        coefs <- data.frame(coef(summary(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)))

balanced_dissimilarity_sbt_fishing_model_results_row <- data.table(matrix(c("sbt", #depth
                                                            T, #scaled
                                                            "mean", #temp var
                                                            F, #fishing
                                                            F, #temp fishing interaction
                                                            "yearly_mean_bypoint_avg.s+survey_unit", #mixed effect
                                                            NA, #mixed effect
                                                            round(coefs[1,1],3), #intercept
                                                            round(coefs[2,1],3),#temp coef
                                                            round(coefs[2,4],3),#coef p value
                                                            NA,#fishing coef
                                                            NA,#coef p value
                                                            NA, #interact coef (fishing and temp)
                                                            NA, #coef p value (fishing and temp)
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)[[1]],3), #marginal r squared
                                                round(r.squaredGLMM(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)[[2]],3), #conditional r-squared
                                                            round(AICc(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract),3),#AICc
                                  summary(allreg_dissimilarity_sbt_mean_avg_fixed_nointeract)$df[2]) #degrees of freedom 
                                                            ,nrow =1))

balanced_dissimilarity_sbt_fishing_model_results <- rbind(balanced_dissimilarity_sbt_fishing_model_results, balanced_dissimilarity_sbt_fishing_model_results_row, use.names = F)
    
```

Show model ranking
```{r}
View(balanced_dissimilarity_sbt_fishing_model_results)

saveRDS(balanced_dissimilarity_sbt_fishing_model_results, here::here("output", "balanced_dissimilarity_sbt_fishing_model_results.Rds"))
```


Best overall model (by AICc)
  - Fishing as a fixed effect without temperature or survey unit
  - Raw mean temperature with interaction with fishing, and random intercept (no slope) for survey unit
  - Dissimilarity declines with fishing and temperature, positive interaction between temp and fishing (so, at higher fishing pressure, less negative slope between fishing and temperature)

Carry these forward
---


###What if we also tie in latitude and spp num?
```{r yearly count of species}
allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg*spp_count_annual.s + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

#check variance inflation factor
car::vif(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count)

allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count_nointereact <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_mean_bypoint_avg+spp_count_annual.s + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)


#compare to best model without gamma (spp_count)
AICc(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly, allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count, allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count_nointereact)

#Model with fishing and temperature performs better than model that adds in interaction with annual species count (scaled), delta AICc = 16

r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly)
summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_surveyunitrandomslopeonly)
r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count)
summary(allreg_dissimilarity_fishing_mean_mod_sbt_mean_avg_spp_count)

#How does relative fishing pressure relate to gamma diversity?
ggplot(dissimilarities_temp_fishing_regstats) +
  geom_point(aes(x = spp_count_annual.s, y = summed_tonnes_scaled_byreg)) +
  theme_classic()

summary(lm(summed_tonnes_scaled_byreg~spp_count_annual.s, data = dissimilarities_temp_fishing_regstats))

#How does mean temperature relate to gamma diversity?
ggplot(dissimilarities_temp_fishing_regstats) +
  geom_point(aes(x = spp_count_annual.s, y = yearly_mean_bypoint_avg)) +
  theme_classic()

summary(lm(yearly_mean_bypoint_avg~spp_count_annual.s, data = dissimilarities_temp_fishing_regstats))

#correlation?
cor.test(dissimilarities_temp_fishing_regstats$yearly_max_bypoint_avg, dissimilarities_temp_fishing_regstats$spp_count_annual)


```

When no gamma diversity included
Fixed effects:
                                                     Estimate Std. Error         df t value Pr(>|t|)    
(Intercept)                                         6.051e-01  2.458e-02  6.811e+01  24.619  < 2e-16 ***
summed_tonnes_scaled_byreg                         -2.374e-02  5.159e-03  7.224e+02  -4.601 4.96e-06 ***
yearly_mean_bypoint_avg                            -1.023e-03  1.855e-03  4.098e+02  -0.552    0.581    
summed_tonnes_scaled_byreg:yearly_mean_bypoint_avg  2.031e-03  5.045e-04  7.305e+02   4.025 6.28e-05 ***

And when we include gamma diversity and it's interactions
Fixed effects:
                                                                        Estimate Std. Error         df t value Pr(>|t|)    
(Intercept)                                                            6.049e-01  2.186e-02  6.935e+01  27.673  < 2e-16 ***
summed_tonnes_scaled_byreg                                            -1.156e-02  5.267e-03  7.292e+02  -2.194   0.0285 *  
yearly_mean_bypoint_avg                                                9.582e-05  1.794e-03  3.026e+02   0.053   0.9574    
spp_count_annual.s                                                     6.774e-02  9.541e-03  6.985e+02   7.100 3.07e-12 ***
summed_tonnes_scaled_byreg:yearly_mean_bypoint_avg                     8.800e-04  5.417e-04  7.367e+02   1.624   0.1047    
summed_tonnes_scaled_byreg:spp_count_annual.s                          1.201e-02  4.916e-03  7.087e+02   2.442   0.0148 *  
yearly_mean_bypoint_avg:spp_count_annual.s                            -4.491e-03  1.014e-03  6.788e+02  -4.427 1.11e-05 ***
summed_tonnes_scaled_byreg:yearly_mean_bypoint_avg:spp_count_annual.s  6.815e-05  4.859e-04  7.134e+02   0.140   0.8885    

```{r latitude}
allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_mid_lat <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_max_bypoint_avg*mid_lat + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_mid_lat_spp_num <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_max_bypoint_avg*mid_lat*spp_num.s + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

AIC(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num, allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_mid_lat,allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_mid_lat_spp_num)

summary(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num)
r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num)

#no interaction with spp num?
allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num_nointeract <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*yearly_max_bypoint_avg+spp_num.s + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

#exclude temperature?
allreg_dissimilarity_fishing_mean_mod_spp_num <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg*spp_num.s + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

#exclude temp no interactions
allreg_dissimilarity_fishing_mean_mod_spp_num_nointeract <- lmer(bray_curtis_dissimilarity_balanced_mean ~ summed_tonnes_scaled_byreg+spp_num.s + (1|survey_unit), data = dissimilarities_temp_fishing_regstats)

AICc(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num_nointeract,allreg_dissimilarity_fishing_mean_mod_spp_num, allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num,allreg_dissimilarity_fishing_mean_mod_spp_num_nointeract)

summary(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num_nointeract)
r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg_spp_num_nointeract)

#no temp performs better
summary(allreg_dissimilarity_fishing_mean_mod_spp_num_nointeract)
r.squaredGLMM(allreg_dissimilarity_fishing_mean_mod_spp_num_nointeract)

ggplot(dissimilarities_temp_fishing_regstats) +
  geom_point(aes(x = spp_num, y = bray_curtis_dissimilarity_balanced_mean, color = yearly_max_bypoint_avg)) +
  theme_classic()

ggplot(dissimilarities_temp_fishing_regstats) +
  geom_point(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = yearly_max_bypoint_avg)) +
  geom_smooth(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean)) +
  theme_classic()
```

Patterns appear to be very survey dependent, and there's a lot of unexplained year to year variation.
- Warmer survey regions are more highly differentiated in general (makes sense, higher diversity )
- However, when we include spp num and fishing, temp drops out as a strong predictor
- As fishing pressure increases, dissimilarity decreases (more fishing = more homogenous)
- As # species increases, dissimilarity increases (more species overall = more heterogenous)
- From before, more species, more negative dissimilarity coefficient (more likely to be differentiating over time)

#####Plot just dissimilarity ~ relative fishing pressure coefficients of each region (Like figure 1b)
```{r}
#unique survey unit year combos
survey_unit_sampling_years <- unique(region_stats[,.(survey_unit, years_sampled)]) #unique survey unit year combos
                                    

 # see group coefficients and confidence intervals
fishing_model_coefs_reduced <- data.table(transform(as.data.frame(ranef(allreg_dissimilarity_fishing_mean_mod)), lwr = condval - 1.96*condsd, upr = condval + 1.96*condsd))
#https://stackoverflow.com/questions/69805532/extract-the-confidence-intervals-of-lmer-random-effects-plotted-with-dotplotra


#ONLY SLOPES
fishing_model_coefs_reduced <- fishing_model_coefs_reduced[term == "summed_tonnes_scaled_byreg",]

fishing_model_coefs_reduced[,survey_unit := grp][,summed_tonnes_scaled_byreg := condval]

#merge with duration of survey
fishing_model_coefs_reduced_length <- fishing_model_coefs_reduced[survey_unit_sampling_years, on = "survey_unit"]


fishing_model_coefs_reduced_length[,years_sampled := as.numeric(years_sampled)][,Slope_Direction := ifelse(summed_tonnes_scaled_byreg > 0, "Positive","Negative")]

#
fishing_model_coefs_reduced_length <- fishing_model_coefs_reduced_length[color_link, on = "survey_unit"]


#does it cross zero?
fishing_model_coefs_reduced_length[,significant := ifelse(lwr >0 & upr>0,T,ifelse(lwr<0 & upr<0,T,F))]

#delete all obs that are significant
fishing_model_coefs_reduced_length.r <- fishing_model_coefs_reduced_length[significant == F,]

#order table by coefficient
setorder(fishing_model_coefs_reduced_length, summed_tonnes_scaled_byreg)

BC_balanced_fishing_model_coefs_reduced_length.unique <- unique(fishing_model_coefs_reduced_length[,.(condval,condsd, lwr, upr, survey_unit, summed_tonnes_scaled_byreg, years_sampled, Slope_Direction, hex, Survey_Name_Season, significant)]) 

#extract color hexes
#year adj coef order
color_year_adj_order <-BC_balanced_fishing_model_coefs_reduced_length.unique[,hex]

#alphabetical order
BC_balanced_fishing_model_coefs_reduced_length.unique.alpha <- setorder(BC_balanced_fishing_model_coefs_reduced_length.unique, Survey_Name_Season)
color_alpha_order <- BC_balanced_fishing_model_coefs_reduced_length.unique.alpha[,hex]

saveRDS(BC_balanced_fishing_model_coefs_reduced_length.unique, here::here("output","region_stats","BC_balanced_fishing_model_coefs_reduced_length.unique.Rds"))
```

Bar Plot Coefficient Fishing LMER
```{r bar plot of fishing coefficients}
BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced <- ggplot() +
    geom_errorbar(data = fishing_model_coefs_reduced_length, aes(x = reorder(Survey_Name_Season, summed_tonnes_scaled_byreg) , y = summed_tonnes_scaled_byreg, label = Survey_Name_Season, ymin = lwr, ymax = upr), fill = "grey", width = 0) + #add confidence intervals
  geom_point(data = fishing_model_coefs_reduced_length, aes(x = reorder(Survey_Name_Season, summed_tonnes_scaled_byreg) , y = summed_tonnes_scaled_byreg, label = Survey_Name_Season, 
      #size = years_sampled,
      fill = Slope_Direction), stat = 'identity', shape = 21, color = "black") +
  scale_fill_manual(values = c("white","black"), name = "Slope Direction") +
  geom_point(data = fishing_model_coefs_reduced_length.r, aes(x = reorder(Survey_Name_Season, summed_tonnes_scaled_byreg) , y = summed_tonnes_scaled_byreg, 
         #size = years_sampled, 
          label = Survey_Name_Season), stat = 'identity', fill = "grey",color = "grey", shape = 21) +
#  scale_size_binned(range = c(1,8), name = "Survey period\nlength") +
  geom_hline(yintercept = 0) +
  xlab("Survey unit") +
  ylab("Balanced BC dissimilarity ~\nrelative fishing pressure") +
  coord_flip() +
  theme_classic()

#+
#  theme(axis.text.y = element_text(colour = color_summed_tonnes_scaled_byreg_order, face = "bold"), axis.title.y = element_blank())

BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced

#save as independent grob to merge with fishing
saveRDS(BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced, here::here("figures","BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced.Rds"))
```

###Link temp plots with fishing pressure plot
```{r link bottom temp to lollypop plot}
#Mean temp
BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced <- readRDS(here::here("figures","BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced.Rds"))

#relative mean temp
BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced <- readRDS(here::here("figures","BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced.Rds"))

#merge
bottom_temp_fishing_coefficients_lollypop <- cowplot::plot_grid(BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced+theme(axis.title.y = element_blank(), legend.position = "null"), BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced+theme(axis.title.y = element_blank(), legend.position = "null"), BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced+theme(axis.title.y = element_blank(), legend.position = "null"), cowplot::get_legend(BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced),
          nrow = 1, ncol = 4, rel_widths = c(1,1,1,0.2), rel_height = c(1,1,1,0.2))

ggsave(bottom_temp_fishing_coefficients_lollypop, path = "figures", filename = "bottom_temp_fishing_coefficients_lollypop.jpg", height = 5, width = 17, units = "in")
```

```{r link surface temp to lollypop plot}
#Mean temp
BC_BALANCED_Dissimilarity_Coef_surfaceTEMP_errorbar_reduced <- readRDS(here::here("figures","BC_BALANCED_Dissimilarity_Coef_surfaceTEMP_errorbar_reduced.Rds"))

#relative mean temp
BC_BALANCED_Dissimilarity_Coef_scaled_surfaceTEMP_errorbar_reduced <- readRDS(here::here("figures","BC_BALANCED_Dissimilarity_Coef_scaled_surfaceTEMP_errorbar_reduced.Rds"))

#merge
surface_temp_fishing_coefficients_lollypop <- cowplot::plot_grid(BC_BALANCED_Dissimilarity_Coef_surfaceTEMP_errorbar_reduced+theme(axis.title.y = element_blank(), legend.position = "null"), BC_BALANCED_Dissimilarity_Coef_scaled_surfaceTEMP_errorbar_reduced+theme(axis.title.y = element_blank(), legend.position = "null"), BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced+theme(axis.title.y = element_blank(), legend.position = "null"), cowplot::get_legend(BC_BALANCED_Dissimilarity_Coef_FISHING_errorbar_reduced),
          nrow = 1, ncol = 4, rel_widths = c(1,1,1,0.2), rel_height = c(1,1,1,0.2))

surface_temp_fishing_coefficients_lollypop

ggsave(surface_temp_fishing_coefficients_lollypop, path = "figures", filename = "surface_temp_fishing_coefficients_lollypop.jpg", height = 5, width = 17, units = "in")
```

#CODE BELOW MAY NO LONGER BE RELEVANT
Plot this model with interaction
```{r}
library(interactions)
sim_slopes(allreg_dissimilarity_fishing_temp_mod_SDonly, pred = sbt_SD_scaled, modx = summed_tonnes_scaled, johnson_neyman = FALSE)

interact_plot(allreg_dissimilarity_fishing_mean_mod_sbt_max_avg, pred = yearly_max_bypoint_avg, modx = summed_tonnes_scaled_byreg, plot.points = T, colors = c("#b3ffe4","#00d68b","#003d28"), x.label = "Maximum Sea Surface Temperature", y.label = "Mean Annual Bray Curtis Dissimilarity") + theme_classic()

ggsave(filename = "interaction_fish_temp.png" ,height = 4, width = 10)

interact_plot(allreg_dissimilarity_fishing_temp_mod_SDonly, pred = sbt_SD_scaled, modx = summed_tonnes_scaled, linearity.check = TRUE, 
              plot.points = TRUE) #check linearity 

```
Summary: Steepest slope between temp and dissimilarity when fishing is high