---
title: "Data Set Statistics"
output: html_notebook
---

This code produces a set of data set statistics included in the manuscript

```{r setup}

library(data.table)


FishGlob_clean <- readRDS(here::here("data", "cleaned", "FishGlob.wellsampledyearscells_complete.final.rds"))
```


Additional cleaning from dissim_metric_space_time_3.Rmd

Delete these observations above except for MEDITS (we will do trends in abundance metrics for this region)
```{r}
#delete all rows where wgt_cpue is NA,  unless it is MEDITS region
FishGlob_clean.noNA <- FishGlob_clean[(survey != "MEDITS" & !is.na(wgt_cpue)) | survey == "MEDITS"]

#check
summary(FishGlob_clean.noNA[, wgt_cpue]) #why inf? 13 observations from GSL-N,  I will delete these
FishGlob_clean.noNA <- copy(FishGlob_clean.noNA)[!is.infinite(wgt_cpue), ]

```

For NZ-CHAT, we want to lump December observations with next year of observations (January,  February)
```{r}
FishGlob_clean.noNA[survey_unit == "NZ-CHAT" & month == 12,  year := year+1, ]
```

Some spp are duplicated within a haul. In all cases,  this is due to verbatim names matching to a single accepted name. Therefore,  we will sum these wgts and abundances
```{r}
FishGlob_clean.noNA[, wgt := sum(wgt,  na.rm = T), .(accepted_name,  haul_id)][, 
                     wgt_h := sum(wgt_h,  na.rm = T), .(accepted_name,  haul_id)][, 
                     wgt_cpue := sum(wgt_cpue,  na.rm = T), .(accepted_name,  haul_id)][, 
                     num := sum(num,  na.rm = T), .(accepted_name,  haul_id)][, 
                     num_h := sum(num_h,  na.rm = T), .(accepted_name,  haul_id)][, 
                     num_cpue := sum(num_cpue,  na.rm = T), .(accepted_name,  haul_id)]

FishGlob_clean.noNA <- unique(FishGlob_clean.noNA[,.(survey, haul_id, country, sub_area, continent, stat_rec, station, stratum, year, month, day, quarter, season, latitude, longitude, haul_dur, area_swept, gear, depth, sbt, sst, num, num_h, num_cpue, wgt, wgt_h, wgt_cpue, verbatim_aphia_id, accepted_name, aphia_id, SpecCode, kingdom, phylum, class, order, family, genus, rank, survey_unit, years_sampled, cell_ID, cell_year_count, year_cell_count, years_sampled_update)])
```

Total observations?
```{r}
nrow(FishGlob_clean.noNA)
```

Total hauls?
```{r}
length(unique(FishGlob_clean.noNA[,haul_id]))
```

Total survey units?
```{r}
length(unique(FishGlob_clean.noNA[,survey_unit]))
```

Total species?
```{r}
length(unique(FishGlob_clean.noNA[,accepted_name]))
```

