---
title: "Annual Balanced BC Dissimilarity vs. SODA Temperature for all Survey Units"
output: html_notebook
---

This code is Script X for Kitchel et al. TITLE manuscript.

- This project is a collaborative effort to describe changes in taxonomic composition  of fish communities around the world--as sampled by bottom trawl surveys.

- Code by Zoë J. Kitchel

SESSION INFO TO DO

##Here, we try to use bottom temperature to predict annual dissimilarity for all survey units

```{r setup}

library(data.table)
library(ggplot2)
library(lme4)
library(lmerTest)
library(MuMIn)


SODA_data_temp_avgs_full <- readRDS(here::here("data","Temperature","SODA_data_temp_avgs_full.rds"))
#don't feel confident about SODA temp before 1980 right now, start then

SODA_data_temp_avgs_full <- SODA_data_temp_avgs_full[year_for_avg >= 1980,]

SODA_data_temp_avgs_full[,year := year_for_avg]

#pull in average distance decay values
distances_dissimilarities_allyears.r <- readRDS(here::here("output","distance_decay","distances_dissimilarities_allyears.r.rds"))

```

###Palette for Plotting
Palette for plotting all 37 survey units
(Prep for eventual plots)
```{r link colors to survey units}
survey_unit.list <- levels(distances_dissimilarities_allyears.r[,factor(survey_unit)])

palette_37 <- c(
  "#5A5156", #AI
  "#F6222E", #CHL
  "#F8A19F", #DFO-NF
  "#16FF32", #DFO-QCS
  "#DF00DB", #BITS-1
  "#DB8EDA", #BITS-4
  "#325A9B", #EBS
  "#3283FE", #EVHOE
  "#FEAF16", #FR-CGFS
  "#1C8356", #GMEX-Summer
  "#C4451C", #GOA
  "#85660D", #GRL-DE
  "#B0009F", #GSL-N
  "#BF79B8", #GSL-S
  "#1CBE4F", #ICE-GFS
  "#782AB6", #IE-IGFS
  "#90AD1C", #MEDITS
  "#6B003A", #NAM
  "#A75B00", #NEUS-Fall
  "#E3B072", #NEUS-Spring
  "#02E8B6", #NIGFS-1
  "#97E7D5", #NIGFS-4
  "#B00068", #Nor-BTS-3
  "#00B9E3", #NS-IBTS-1
  "#95E2F4", #NS-IBTS-3
  "#B3CE73", #NZ-CHAT
  "#689500", #NZ-ECSI
  "#AAF400", #NZ-WCSI
  "#AA0DFE", #PT-IBTS
  "#FA0087", #S-GEORG
  "#DEA0FD", #SCS-Summer
  "#FCEF88", #SEUS-fall
  "#A59405", #SEUS-spring
  "#FCE100", #SEUS-summer
  "#C075A6", #WCANN
  "#BDCDFF", #ZAF-ATL
  "#003EFF"  #ZAF-IND
)

color_link <- data.table(survey_unit = survey_unit.list,hex = palette_37)
```

Add names for plotting
```{r add names for plotting}

name_helper <- data.table(Survey_Name_Season = c("Aleutian Islands",
                                    "Baltic Sea Q1",
                                    "Baltic Sea Q4",
                                    "Chile",
                                    "Newfoundland",
                                    "Queen Charlotte Sound",
                                    "Eastern Bering Sea",
                                    "Bay of Biscay",
                                    "English Channel",
                                    "Gulf of Mexico",
                                    "Gulf of Alaska",
                                    "Greenland",
                                    "N Gulf of St. Lawrence",
                                    "S Gulf of St. Lawrence",
                                    "Iceland",
                                    "Irish Sea",
                                    "Mediterranean",
                                    "Namibia",
                                    "NE US Fall",
                                    "NE US Spring",
                                    "N Ireland Q1",
                                    "N Ireland Q4",
                                    "Norway",
                                    "N Sea Q1",
                                    "N Sea Q3",
                                    "Chatham Rise",
                                    "E Coast S Island NZ",
                                    "W Coast S Island NZ",
                                    "Portugal",
                                    "S Georgia Straight",
                                  "Scotian Shelf",
                                  "SE US Fall",
                                  "SE US Spring",
                                  "SE US Summer",
                                  "W Coast US",
                                  "Atlantic Ocean ZA",
                                  "Indian Ocean ZA"),
                          survey_unit = c(
                                  "AI",        
                                  "BITS-1",    
                                  "BITS-4",    
                                  "CHL",       
                                  "DFO-NF",    
                                  "DFO-QCS",   
                                  "EBS",       
                                  "EVHOE",     
                                  "FR-CGFS",   
                                  "GMEX-Summer",
                                  "GOA",       
                                  "GRL-DE",    
                                  "GSL-N",     
                                  "GSL-S",     
                                  "ICE-GFS",   
                                  "IE-IGFS",   
                                  "MEDITS",    
                                  "NAM",       
                                  "NEUS-Fall", 
                                  "NEUS-Spring",
                                  "NIGFS-1",   
                                  "NIGFS-4",   
                                  "Nor-BTS-3", 
                                  "NS-IBTS-1", 
                                  "NS-IBTS-3", 
                                  "NZ-CHAT",   
                                  "NZ-ECSI",   
                                  "NZ-WCSI",   
                                  "PT-IBTS",   
                                  "S-GEORG",   
                                  "SCS-SUMMER",
                                  "SEUS-fall", 
                                  "SEUS-spring",
                                  "SEUS-summer",
                                  "WCANN",     
                                  "ZAF-ATL",   
                                  "ZAF-IND"   
                          ))

color_link <- color_link[name_helper, on = "survey_unit"]

```


Put into one data table
```{r link temp to avg values}
dissimilarities_temp <- SODA_data_temp_avgs_full[distances_dissimilarities_allyears.r, on = c("year","survey_unit")]
```

Pull in dissimilarity ~ model coefficients
```{r}
BC_balanced_model_coefs_reduced_length.unique <- readRDS(here::here("output","region_stats","BC_balanced_model_coefs_reduced_length.unique.Rds"))
```



Table that will be populated with model results
```{r}
#depth, scaled, temp var, coefficient, p-value, r^2, AICc
balanced_dissimilarity_sbt_model_results <- data.table(Depth = as.character(),
                                                       Scaled = as.character(),
                                                       `Temp variable` = as.character(),
                                                       Intercept = as.numeric(),
                                                       `Temp coefficient` = as.numeric(),
                                                       `Coefficient p-value` = as.numeric(),
                                                       `R-squared` = as.numeric(),
                                                       AICc = as.numeric())
                                                  
```


How does this trend hold up for all regions?
###UNSCALED

####Mean temperature
```{r mean sbt}
#for all regions
(dissimilarity_BC_balanced_sbt_mean <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_mean, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_mean.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_mean_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_mean_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_mean_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_balanced_sbt_mean_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg, data = dissimilarities_temp) #this converges (allows both intercept and slope to vary with survey_unit)

summary(dissimilarity_BC_balanced_sbt_mean_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_mean_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_mean_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "mean", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_mean_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_mean_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_mean_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_mean_mod),3)
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Min temperature
```{r min sbt}
#for all regions
(dissimilarity_BC_balanced_sbt_min <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_min, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_min.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_min_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_min_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_min_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_min_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_balanced_sbt_min_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_min_bypoint_avg, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_min_mod) #insignificant relationship


confint <- confint(dissimilarity_BC_balanced_sbt_min_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_min_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "min", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_min_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_min_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_min_mod)$r.squared,3),#rsquared squared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_min_mod),3)#AICc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Max sbt
```{r max sbt}
#for all regions
(dissimilarity_BC_balanced_sbt_max <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_max, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_max.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_max_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_max_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_max_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_max_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_balanced_sbt_max_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_max_bypoint_avg, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_max_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_max_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_max_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "max", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_max_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_max_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_max_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_max_mod),3)#AICc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```

####Seas sbt
```{r seas sbt}
#for all regions
(dissimilarity_BC_balanced_sbt_seas <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_seas, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_seas.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_seas_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of bottom temperature (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_seas_bypoint_avg, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_seas_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_seas_facet.jpg", height = 10, width = 11, unit = "in")


dissimilarity_BC_balanced_sbt_seas_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_seas_bypoint_avg, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_seas_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_seas_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_seas_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "seas", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seas_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seas_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_seas_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_seas_mod),3)#AICc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```

###Standard deviation of grid cells
####Mean temperature SD
```{r mean sbt SD}
#for all regions
(dissimilarity_BC_balanced_sbt_meanSD <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_meanSD, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_meanSD.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_meanSD_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_meanSD_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_meanSD_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_balanced_sbt_meanSD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_SD, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_meanSD_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_meanSD_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_meanSD_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "meanSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_meanSD_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_meanSD_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_meanSD_mod)$r.squared,3),
                                                 #rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_meanSD_mod),3)#AICc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)


```

####Min temperature SD
```{r min sbt SD}
#for all regions
(dissimilarity_BC_balanced_sbt_minSD <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_min_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_min_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_minSD, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_minSD.jpg", height = 4, width = 9, unit = "in") 

#faceted
dissimilarity_BC_balanced_sbt_minSD_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_min_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_minSD_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_minSD_facet.jpg", height = 10, width = 11, unit = "in")


dissimilarity_BC_balanced_sbt_minSD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_min_bypoint_SD, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_minSD_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_minSD_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_minSD_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "minSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_minSD_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_minSD_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_minSD_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_minSD_mod),3)#aicc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Max sbt SD
```{r max sbt SD}
#for all regions
dissimilarity_BC_balanced_sbt_maxSD <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_max_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_max_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_maxSD, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_maxSD.jpg", height = 4, width = 9, unit = "in") 

#faceted
dissimilarity_BC_balanced_sbt_maxSD_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_max_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_maxSD_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_maxSD_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_balanced_sbt_maxSD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_max_bypoint_SD, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_maxSD_mod) #significant relationship (0.02)

confint <- confint(dissimilarity_BC_balanced_sbt_maxSD_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_maxSD_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "maxSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_maxSD_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_maxSD_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_maxSD_mod)$r.squared,3),#rsquareed
                                                 round(AICc(dissimilarity_BC_balanced_sbt_maxSD_mod),3)#AICc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```

####Seas sbt SD
```{r seas sbt SD}
#for all regions
(dissimilarity_BC_balanced_sbt_seasSD <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_seas_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_seas_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_seasSD, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_seasSD.jpg", height = 4, width = 9, unit = "in")

#faceted
dissimilarity_BC_balanced_sbt_seasSD_facet <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of bottom temperature SD (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_seas_bypoint_SD, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_seasSD_facet, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_seasSD_facet.jpg", height = 10, width = 11, unit = "in")

dissimilarity_BC_balanced_sbt_seasSD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_seas_bypoint_SD, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_seasSD_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_seasSD_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_seasSD_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 F, #scaled
                                                 "seasSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seasSD_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seasSD_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_seasSD_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_seasSD_mod),3)#aicc
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)



```


###Raw temp values: Comparing temperature predictors for raw
```{r compare raw temp predictors}

setorder(balanced_dissimilarity_sbt_model_results,AICc)
balanced_dissimilarity_sbt_model_results


```
The standard deviation of temperature seasonality in the 12 months before a survey is the best predictor.

As the spatial heterogeneity of raw temperature seasonality 12 months before a survey increases, the dissimilarity also increases (0.544 * ˚C). More highly differentiated reasons re:seasonality are more heterogenous.

---
##SCALED
###Avg of grid cells
####Mean temperature scaled
```{r mean sbt scaled}
#for all regions
dissimilarity_BC_balanced_sbt_mean_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean bottom temperature scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_mean_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_mean_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_mean_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_mean_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_mean_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_mean_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "mean", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_mean_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_mean_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_mean_scaled_mod)$r.squared,3),#rsquared
                                                 round(AICc(dissimilarity_BC_balanced_sbt_mean_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Min temperature scaled
```{r min sbt scaled}
#for all regions
dissimilarity_BC_balanced_sbt_min_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min bottom temperature scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_min_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_min_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_min_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_min_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_min_bypoint_avg.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_min_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_min_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_min_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "min", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_min_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_min_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_min_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_min_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Max sbt scaled
```{r max sbt scaled}
#for all regions
dissimilarity_BC_balanced_sbt_max_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max bottom temperature scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_max_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_max_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_max_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_max_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_max_bypoint_avg.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_max_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_max_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_max_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "max", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_max_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_max_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_max_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_max_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```

####Seas sbt scaled
```{r seas sbt scaled}
#for all regions
dissimilarity_BC_balanced_sbt_seas_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of bottom temperature scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_seas_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_seas_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_seas_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_seas_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_seas_bypoint_avg.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_seas_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_seas_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_seas_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "seas", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seas_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seas_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_seas_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_seas_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```
###Standard deviation of grid cells
####Mean temperature SD scaled
```{r mean sbt SD scaled}
#for all regions
(dissimilarity_BC_balanced_sbt_meanSD_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Mean bottom temperature SD scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_mean_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_meanSD_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_meanSD_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_meanSD_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_SD.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "meanSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_meanSD_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Min temperature SD scaled
```{r min sbt SD scaled}
#for all regions
dissimilarity_BC_balanced_sbt_minSD_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Min bottom temperature SD scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_min_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_min_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_minSD_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_minSD_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_minSD_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_min_bypoint_SD.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_minSD_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_minSD_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_minSD_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "minSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_minSD_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_minSD_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_minSD_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_minSD_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)
```

####Max sbt SD scaled
```{r max sbt SD scaled}
#for all regions
dissimilarity_BC_balanced_sbt_maxSD_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Max bottom temperature SD scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_max_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_max_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_max_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_maxSD_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_maxSD_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_maxSD_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_max_bypoint_SD.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "maxSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_maxSD_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```

####Seas sbt SD scaled
```{r seas sbt SD scaled}
#for all regions
dissimilarity_BC_balanced_sbt_seasSD_scaled <- ggplot(data = dissimilarities_temp) +
  labs(x = "Seasonality of bottom temperature SD scaled (˚C)",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_seas_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), alpha = 0.3) +
  geom_line(aes(x = yearly_seas_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean, color = survey_unit), stat="smooth", method = "lm") +
  scale_color_manual(values = c(palette_37)) +
  geom_smooth(aes(x = yearly_seas_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm", se = F, color  = "black") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_seasSD_scaled, path  = here::here("figures","distance_decay"), filename = "dissimilarity_BC_balanced_sbt_seasSD_scaled.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_seasSD_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_seas_bypoint_SD.s, data = dissimilarities_temp)

summary(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod) #insignificant relationship

confint <- confint(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod) #confidence interval

coefs <- data.frame(coef(summary(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod))) #table with coefficients, #Satterthwaite's degrees of freedom, and p-value approximation for fixed effects

#input results into table
balanced_dissimilarity_sbt_model_results_row <- data.table(matrix(c("sbt", #depth
                                                 T, #scaled
                                                 "seasSD", #temp var
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod)[[1]],3),
                                                        " ± ",
                                                        round((confint[1,2]-confint[1,1])/2,3)), #intercept
                                                 paste0(round(coef(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod)[[2]],3),
                                                        " ± ",
                                                        round((confint[2,2]-confint[2,1])/2,3)), #coef
                                                 round(coefs[2,4],3), #pvalue
                                                 round(summary(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod)$r.squared,3),#rsquared
                                                
                                                 round(AICc(dissimilarity_BC_balanced_sbt_seasSD_scaled_mod),3)#AICc
                                                 
                                                 ),nrow = 1))

#merge with larger table
balanced_dissimilarity_sbt_model_results <- rbind(balanced_dissimilarity_sbt_model_results,balanced_dissimilarity_sbt_model_results_row, use.names = F)

```



###Comparing scaled temperature predictors
```{r compare scaled temp predictors}

balanced_dissimilarity_sbt_model_results[Scaled == T,]


#for all temp mods, almost nothing is described by scaled temp in region (0.03% of variation)
```
All temp predictors perform similarly well (poorly...)
SD of min temp, and avg mean temp are best two.
Relative mean temperature for the 12 months before survey is the best predictor. As temp increases, dissimilarity decreases. Relatively warm years are more homogenous. As SD of min temp increases, dissimilarity decreases (opposite of what you woudl expect).

####What to carry forward:

best raw:
SD of seasonality
dissimilarity_BC_balanced_sbt_seasSD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_seas_bypoint_SD, data = dissimilarities_temp)

best scaled: 
all performed similarly well, but minSD and mean were the best

dissimilarity_BC_balanced_sbt_mean_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_mean_bypoint_avg.s, data = dissimilarities_temp)

dissimilarity_BC_balanced_sbt_minSD_scaled_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_min_bypoint_SD.s, data = dissimilarities_temp)



Best models
```{r}
balanced_dissimilarity_sbt_model_results

saveRDS(balanced_dissimilarity_sbt_model_results, here::here("output","balanced_dissimilarity_sbt_model_results.rds"))
fwrite(balanced_dissimilarity_sbt_model_results, here::here("output","balanced_dissimilarity_sbt_model_results.csv"))
```


####Finally, plot best raw model
Raw: dissimilarity_BC_balanced_sbt_seasSD_mod
dissimilarity_BC_balanced_sbt_seasSD_mod <- lm(bray_curtis_dissimilarity_balanced_mean ~ yearly_seas_bypoint_SD, data = dissimilarities_temp)


```{r}

#for all regions merged
(dissimilarity_BC_balanced_sbt_SDseas.final <- ggplot(data = dissimilarities_temp.nona) +
  labs(x = "SD of temperature seasonality",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = as.numeric(yearly_seas_bypoint_SD), y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = as.numeric(yearly_seas_bypoint_SD), y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_SDseas.final, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_SDseas.final.jpg", height = 4, width = 9, unit = "in") 

(dissimilarity_BC_balanced_sbt_SDseas.final_facet <- ggplot(data = dissimilarities_temp.nona) +
  labs(x = "SD of temperature seasonality",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = as.numeric(yearly_seas_bypoint_SD), y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = as.numeric(yearly_seas_bypoint_SD), y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales= "free") +
  theme_classic())


ggsave(dissimilarity_BC_balanced_sbt_SDseas.final_facet, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_SDseas.final_facet.jpg", height = 10, width = 16, unit = "in")

```

#SKIP FOR NOW
Plot just dissimilarity ~ raw temp coefficients of each region (Like figure 1b)
```{r}
#unique survey unit year combos
survey_unit_sampling_years <- unique(BC_balanced_model_coefs_reduced_length.unique[,.(survey_unit, years_sampled)]) #unique survey unit year combos
                                    

 # see group coefficients and confidence intervals
temp_model_coefs_reduced <- data.table(transform(as.data.frame(ranef(dissimilarity_BC_balanced_sbt_mean_mod)), lwr = condval - 1.96*condsd, upr = condval + 1.96*condsd))
#https://stackoverflow.com/questions/69805532/extract-the-confidence-intervals-of-lm-random-effects-plotted-with-dotplotra


#ONLY SLOPES
temp_model_coefs_reduced <- temp_model_coefs_reduced[term == "yearly_mean_bypoint_avg",]

temp_model_coefs_reduced[,survey_unit := grp][,yearly_mean_bypoint_avg := condval]

#merge with duration of survey
temp_model_coefs_reduced_length <- temp_model_coefs_reduced[survey_unit_sampling_years, on = "survey_unit"]


temp_model_coefs_reduced_length[,years_sampled := as.numeric(years_sampled)][,Slope_Direction := ifelse(yearly_mean_bypoint_avg > 0, "Positive","Negative")]

#
temp_model_coefs_reduced_length <- temp_model_coefs_reduced_length[color_link, on = "survey_unit"]


#does it cross zero?
temp_model_coefs_reduced_length[,significant := ifelse(lwr >0 & upr>0,T,ifelse(lwr<0 & upr<0,T,F))]

#delete all obs that are significant
temp_model_coefs_reduced_length.r <- temp_model_coefs_reduced_length[significant == F,]

#order table by coefficient
setorder(temp_model_coefs_reduced_length, yearly_mean_bypoint_avg)

BC_balanced_temp_model_coefs_reduced_length.unique <- unique(temp_model_coefs_reduced_length[,.(condval,condsd, lwr, upr, survey_unit, yearly_mean_bypoint_avg, years_sampled, Slope_Direction, hex, Survey_Name_Season, significant)]) 

#extract color hexes
#year adj coef order
color_year_adj_order <-BC_balanced_temp_model_coefs_reduced_length.unique[,hex]

#alphabetical order
BC_balanced_temp_model_coefs_reduced_length.unique.alpha <- setorder(BC_balanced_temp_model_coefs_reduced_length.unique, Survey_Name_Season)
color_alpha_order <- BC_balanced_temp_model_coefs_reduced_length.unique.alpha[,hex]

saveRDS(BC_balanced_temp_model_coefs_reduced_length.unique, here::here("output","region_stats","BC_balanced_temp_model_coefs_reduced_length.unique.Rds"))
```

Bar Plot Coefficient Bottom Temperature lm
```{r bar plot of bottom temperature coefficients}
BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced <- ggplot() +
    geom_errorbar(data = temp_model_coefs_reduced_length, aes(x = reorder(Survey_Name_Season, yearly_mean_bypoint_avg) , y = yearly_mean_bypoint_avg, label = Survey_Name_Season, ymin = lwr, ymax = upr), fill = "grey", width = 0) + #add confidence intervals
  geom_point(data = temp_model_coefs_reduced_length, aes(x = reorder(Survey_Name_Season, yearly_mean_bypoint_avg) , y = yearly_mean_bypoint_avg, label = Survey_Name_Season, 
        #size = years_sampled,
        fill = Slope_Direction), stat = 'identity', shape = 21, color = "black") +
  scale_fill_manual(values = c("white","black"), name = "Slope Direction") +
  geom_point(data = temp_model_coefs_reduced_length.r, aes(x = reorder(Survey_Name_Season, yearly_mean_bypoint_avg) , y = yearly_mean_bypoint_avg, 
          #size = years_sampled,
          label = Survey_Name_Season), stat = 'identity', fill = "grey",color = "grey", shape = 21) +
 # scale_size_binned(range = c(1,8), name = "Survey period\nlength") +
  geom_hline(yintercept = 0) +
  xlab("Survey unit") +
  ylab("Balanced BC dissimilarity ~\nraw bottom temperature") +
  coord_flip() +
  theme_classic()

#+
#  theme(axis.text.y = element_text(colour = color_yearly_mean_bypoint_avg_order, face = "bold"), axis.title.y = element_blank())

BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced

#save as independent grob to merge with fishing
saveRDS(BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced, here::here("figures","BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced.Rds"))
```

Scaled: dissimilarity_BC_balanced_sbt_mean_scaled_mod, dissimilarity_BC_balanced_sbt_minSD_scaled_mod
```{r mean scaled sbt}

#for all regions
(dissimilarity_BC_balanced_sbt_mean.s.final <- ggplot(data = dissimilarities_temp.nona) +
  labs(x = "Relative mean bottom temperature",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_mean.s.final, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_mean.s.final.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_mean_facet.s.final <- ggplot(data = dissimilarities_temp.nona) +
  labs(x = "Relative mean bottom temperature",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_mean_facet.s.final, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_mean_facet.s.final.jpg", height = 10, width = 16, unit = "in")

```

```{r SD of min temp scaled}

#for all regions
(dissimilarity_BC_balanced_sbt_min.SD.s <- ggplot(data = dissimilarities_temp.nona) +
  labs(x = "Relative SD of minimum temperature",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_mean_bypoint_avg.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  theme_classic())

ggsave(dissimilarity_BC_balanced_sbt_min.SD.s, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_min.SD.s.jpg", height = 4, width = 9, unit = "in") 

dissimilarity_BC_balanced_sbt_min.SD_facet.s.final <- ggplot(data = dissimilarities_temp.nona) +
  labs(x = "Relative SD of minimum temperature",  y = "Bray Curtis balanced dissimilarity") +
  geom_point(aes(x = yearly_min_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), alpha = 0.3) +
  geom_smooth(aes(x = yearly_min_bypoint_SD.s, y = bray_curtis_dissimilarity_balanced_mean), method = "lm") +
  facet_wrap(~survey_unit, scales = "free") +
  theme_classic()

ggsave(dissimilarity_BC_balanced_sbt_min.SD_facet.s.final, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_min.SD_facet.s.final.jpg", height = 10, width = 16, unit = "in")

```

#SKIP FOR NOW
Plot just dissimilarity ~ scaled temp coefficients of each region (Like figure 1b)
```{r}

 # see group coefficients and confidence intervals
temp_scaled_model_coefs_reduced <- data.table(transform(as.data.frame(ranef(dissimilarity_BC_balanced_sbt_mean_scaled_mod)), lwr = condval - 1.96*condsd, upr = condval + 1.96*condsd))
#https://stackoverflow.com/questions/69805532/extract-the-confidence-intervals-of-lm-random-effects-plotted-with-dotplotra


#ONLY SLOPES
temp_scaled_model_coefs_reduced <- temp_scaled_model_coefs_reduced[term == "yearly_mean_bypoint_avg.s",]

temp_scaled_model_coefs_reduced[,survey_unit := grp][,yearly_mean_bypoint_avg.s := condval]

#merge with duration of survey
temp_scaled_model_coefs_reduced_length <- temp_scaled_model_coefs_reduced[survey_unit_sampling_years, on = "survey_unit"]


temp_scaled_model_coefs_reduced_length[,years_sampled := as.numeric(years_sampled)][,Slope_Direction := ifelse(yearly_mean_bypoint_avg.s > 0, "Positive","Negative")]

#
temp_scaled_model_coefs_reduced_length <- temp_scaled_model_coefs_reduced_length[color_link, on = "survey_unit"]


#does it cross zero?
temp_scaled_model_coefs_reduced_length[,significant := ifelse(lwr >0 & upr>0,T,ifelse(lwr<0 & upr<0,T,F))]

#delete all obs that are significant
temp_scaled_model_coefs_reduced_length.r <- temp_scaled_model_coefs_reduced_length[significant == F,]

#order table by coefficient
setorder(temp_scaled_model_coefs_reduced_length, yearly_mean_bypoint_avg.s)

BC_balanced_temp_scaled_model_coefs_reduced_length.unique <- unique(temp_scaled_model_coefs_reduced_length[,.(condval,condsd, lwr, upr, survey_unit, yearly_mean_bypoint_avg.s, years_sampled, Slope_Direction, hex, Survey_Name_Season, significant)]) 

#extract color hexes
#year adj coef order
color_year_adj_order <-BC_balanced_temp_scaled_model_coefs_reduced_length.unique[,hex]

#alphabetical order
BC_balanced_temp_scaled_model_coefs_reduced_length.unique.alpha <- setorder(BC_balanced_temp_scaled_model_coefs_reduced_length.unique, Survey_Name_Season)
color_alpha_order <- BC_balanced_temp_scaled_model_coefs_reduced_length.unique.alpha[,hex]

saveRDS(BC_balanced_temp_scaled_model_coefs_reduced_length.unique, here::here("output","region_stats","BC_balanced_temp_scaled_model_coefs_reduced_length.unique.Rds"))
```

Bar Plot Coefficient Scaled Bottom Temperature lm
```{r bar plot of scaled bottom temperature coefficients}
BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced <- ggplot() +
    geom_errorbar(data = temp_scaled_model_coefs_reduced_length, aes(x = reorder(Survey_Name_Season, yearly_mean_bypoint_avg.s) , y = yearly_mean_bypoint_avg.s, label = Survey_Name_Season, ymin = lwr, ymax = upr), fill = "grey", width = 0) + #add confidence intervals
  geom_point(data = temp_scaled_model_coefs_reduced_length, aes(x = reorder(Survey_Name_Season, yearly_mean_bypoint_avg.s) , y = yearly_mean_bypoint_avg.s, label = Survey_Name_Season, 
                #size = years_sampled,
                fill = Slope_Direction), stat = 'identity', shape = 21, color = "black") +
  scale_fill_manual(values = c("white","black"), name = "Slope Direction") +
  geom_point(data = temp_scaled_model_coefs_reduced_length.r, aes(x = reorder(Survey_Name_Season, yearly_mean_bypoint_avg.s) , y = yearly_mean_bypoint_avg.s, 
                  #size = years_sampled,
                  label = Survey_Name_Season), stat = 'identity', fill = "grey",color = "grey", shape = 21) +
#  scale_size_binned(range = c(1,8), name = "Survey period\nlength") +
  geom_hline(yintercept = 0) +
  xlab("Survey unit") +
  ylab("Balanced BC dissimilarity ~\nrelative bottom temperature") +
  coord_flip() +
  theme_classic()

#+
#  theme(axis.text.y = element_text(colour = color_yearly_mean_bypoint_avg.s_order, face = "bold"), axis.title.y = element_blank())

BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced

#save as independent grob to merge with fishing
saveRDS(BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced, here::here("figures","BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced.Rds"))
```

Merge lollypops
```{r merge lollypops}
BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced_merge <- cowplot::plot_grid(BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced + theme(legend.position = "null", axis.title.y = element_blank()), BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced + theme(legend.position = "null", axis.title.y = element_blank()), cowplot::get_legend(BC_BALANCED_Dissimilarity_Coef_scaled_BOTTOMTEMP_errorbar_reduced), nrow = 1, ncol = 3, rel_widths = c(1,1,0.2), rel_heights = c(1,1,0.2))

ggsave(BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced_merge, path = "figures", filename = "BC_BALANCED_Dissimilarity_Coef_BOTTOMTEMP_errorbar_reduced_merge.jpg", height = 5, width = 12, units = "in")
```

Merge
```{r}
library(cowplot)
(dissimilarity_BC_balanced_sbt_mean.final.SIMPLIFIED_merge <- plot_grid(dissimilarity_BC_balanced_sbt_mean.finalSIMPLIFIED, dissimilarity_BC_balanced_sbt_mean.s.final.SIMPLIFIED + theme(axis.title.y = element_blank(), axis.text.y = element_blank()), nrow = 1, ncol = 2, labels = c("a.","b."), hjust = -1))

ggsave(dissimilarity_BC_balanced_sbt_mean.final.SIMPLIFIED_merge, path  = here::here("figures","predictor_variables"), filename = "dissimilarity_BC_balanced_sbt_mean.final.SIMPLIFIED_merge.jpg", height = 4, width = 9, unit = "in") 
```