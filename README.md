# Marine communities do not follow the paradigm of increasing similarity through time

Currently in press at PLOS Climate.

*Zoë J. Kitchel, Aurore A. Maureaud, Alexa Fredston, Nancy Shackell, Bastien Mérigot, James T. Thorson, Laurène Pécuchet, Juliano Palacios-Abrantes, Maria L.D. Palomares, Antonio Esteban Acón, Mark Belchier, Gioacchino Bono, Pierluigi Carbonara, Martin A. Collins, Luis A. Cubillos, Tracey P. Fairweather, Maria Cristina Follesa, Cristina Garciá Ruiz, Maria Teresa Farriols Garau, Germana Garofalo, Igor Isajlović, Johannes N. Kathena, Mariano Koen-Alonso, Porzia Maiorano, Chiara Manfredi, Jurgen Mifsud, Richard L. O’Driscoll, Mario Sbrana, Jón Sólmundsson, Maria Teresa Spedicato, Fabrice Stephenson, Karl-Michael Werner, Daniela V. Yepsen, Walter Zupa, Malin L. Pinsky*

Please contact [Z.J. Kitchel](https://www.zoekitchel.com/) with questions about this project. The results are reproducible for the regions with publically available data. The publically available bottom trawl datasets are available for download from the linked [GitHub repository](https://github.com/AquaAuma/FishGlob_data/tree/main/outputs/Compiled_data) associated with [Maureaud et al. 2024](https://doi.org/10.1038/s41597-023-02866-w) and a release available for download on Zenodo (https://zenodo.org/records/10218308).

## Where do data come from?

We used of a number of datasets that are already publicly available and/or published with this project, in addition to some regional datasets that may be available upon request from data providers. These are fully described and cited in the manuscript, but we also list them here for ease of download, access, and attribution. 

* Publicly available trawl data from [FISHGLOB]([https://github.com/AquaAuma/FishGlob_data](https://github.com/AquaAuma/FishGlob_data/tree/main/outputs/Compiled_data), a project to harmonize publicly available trawl survey records from federal agencies around the globe. FISHGLOB has observations for 55 surveys, and 34 of these were used in this project.
* Some regions are unable to share trawl data publically. Data may be available on request from data provider. See Table S1 in the supplementary materials for contact information.
* Sea bottom temperature data from [SODA 3.3.2](http://www.soda.umd.edu/), an ocean reanalysis data product by the University of Maryland available beginning in 1980. 
* Sea surface temperature data from [OISST](https://www.ncei.noaa.gov/products/optimum-interpolation-sst), a historical satellite temperature record from the U.S. National Oceanic and Atmospheric Administration beginning in 1982.
* Historical fishing pressure estimates from [Sea Around Us](https://www.seaaroundus.org/).


## What's in this repository?

The repository is organized as follows:

* `data` contains raw datasets obtained from other sources (described above).
      * Note: Norway (Barents Sea; Nor-BTS) required a data update in September 2023. Norway data can be found in `data` > `Norway_Sep2023` > `NOR-BTS_clean.RData`.
      * Note: Queen Charlotte Sound (DFO-QCS) required a data update in September 2023. Therefore, QCS is excluded from `FISHGLOB_public_v1.5_clean.csv`, and QCS data can be found in `data` > `DFO-QCS_Sep2023` > `QCS_clean.RData`
* `data_prep_code` contains Rmd scripts to access (when possible) and prepare trawl, temperature, and fishing datasets.
* `analysis_code` contains Rmd scripts to run all dissimilarity analyses.
* `figure_code` contains Rmd scripts to make figures not made in other scripts.
* `output` contains outputs of scripts that filter, clean, summarize, or analyze data. Also contains csv, rds, and xlsx files generated by scripts for main and supplementary tables.
* `figures` contains image files generated by scripts for the main and supplemental figures.
* `archive` includes a mismash of scripts,output, figures, and tables that were a part of project development, but do not directly connect to currently used scripts, outputs, figures, or tables. Viewer beware, these are very possibly **wrong**, broken and non-functional but mean something significant to the authors, and are therefore included because ZJK is a hoarder. *NB: some of the folders above have their own internal archives*

## What's not in the repository? 

The following files are not hosted on GitHub:

- The raw publicly available FISHGLOB data (see link above to data download).

- We do not host raw SODA and OISST data because the source files are very large. The SODA sea bottom temperature data were downloaded from [http://www.soda.umd.edu/](http://www.soda.umd.edu/) (accessed May 28, 2023). The NOAA OISST data were downloaded from https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/ (accessed May 19, 2023). 

- We respect that trawl survey data for some regions are not currently publically available. Therefore, we cannot share survey data for South Georgia,the Mediterranean, South Africa, Chile, Namibia, Newfoundland, Greenland, Iceland, or New Zealand. This repository includes scripts that will prepare and process these data, but does not include raw data files for these regions. Table A in S1 Text lists data providers/corresponding authors for each region.

## In what order should things be run?

To reproduce the analysis, run these scripts in order:

**Trawl data preparation:**

1. `data_prep_code` > `fishglob_species` > `prepare_fishglob_dataset_1.Rmd`: This script prepares bottom trawl survey data observations for analysis using survey by survey specific edits. It also integrates data that needed to be updated from FISHGLOB v1.5 -- Norway and Greenland specifically.

1. `data_prep_code` > `fishglob_species` > `standardize_temp_space_2.Rmd`: This script standardizes bottom trawl survey data across space and time. Specifically, it assigns all trawl locations to hexagonal cells, removes any years for a survey that sample less than 70% of cells ever sampled for that survey and then removes any cells that are sampled in less than 70% of years.

**Dissimilarity time series**

1. `analysis_code` > `dissim_metric_space_time_3.Rmd`: This script calculates Bray Curtis and Jaccard total and partitioned dissimilarities for every pairwise tow combination in each survey x year combination. Then, it averages across pairs for annual average for each survey x year.

1. `analysis_code` > `dissim_metric_space_time_3b_15perc_exclude.Rmd`: Same as above but excluding 15% of species from each survey with lowest overall biomass through time series.

1. `analysis_code` > `dissim_metric_space_time_3c_onethird_exclude.Rmd`: Same as above but excluding species that are present in less than 1/3 of years for each survey.

1. `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd`: This script performs main dissimilarity time series analysis.

1. `analysis_code` > `year_dissimilarity_BC_total_models_4b_nullmodelreshuffle.Rmd`: Same as above but reshuffling years 1000x times (null analysis for # of surveys we'd expect to be homogenizing and differentiating by chance if there were no directional trends in dissimilarity through time).

1. `analysis_code` > `year_dissimilarity_BC_balanced_models_4b.Rmd`: Same as above but for Bray Curtis balanced changes component of dissimilarity. (Yes two b's, my apologies)

1. `analysis_code` > `year_dissimilarity_BC_gradient_models_4c.Rmd`: Same as above but for Bray Curtis abundance gradients component of dissimilarity.

1. `analysis_code` > `year_dissimilarity_jaccard_total_models_4d.Rmd`: Same as above but for total Jaccard dissimilarity.

1. `analysis_code` > `year_dissimilarity_BC_total_models_15perc_excl_4e.Rmd`: Same as above but excluding 15% of species from each survey with lowest overall biomass through time series.

1. `analysis_code` > `year_dissimilarity_BC_total_models_onethird_excl_4f.Rmd`: Same as above but excluding species that are present in less than 1/3 of years for each survey.

**Temperature data preparation**

1. `data_prep_code` > `temperature` > `Import_SODA_web_convert_raster_bottomtemp_5a_1.Rmd`

1. `data_prep_code` > `temperature` > `pulling_averaging_SODA_temp_data_5a_2.Rmd`

1. `data_prep_code` > `temperature` > `pulling_averaging_OISST_surface_temp_data_5b_2.Rmd`


**Fishing data preparation**

1. `data_prep_code` > `fishing` > `Pull_SeaAroundUs_6.Rmd`

**Temperature and Fishing as predictors of annual dissimilarity**

1. `analysis_code` > `Regional_statistics_7.Rmd`: merge fishing, and dissimilarity data sets, and then calculate regional statistics, and look at patterns of survey characteristics versus trends in dissimilarity.

1. `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`: Runs and ranks models using temperature, fishing, and survey characteristics to predict annual dissimilarity within surveys.

1. `analysis_code` > `annual_dissim_fishing_temp_model_8b_oisst.Rmd`: Same as above, but for surface temperature (OISST).

**Misc scripts**
Scripts without an associated number are accessory scripts. They are not needed for the main or supplemental analyses, but are informative. See text within specific scripts for info on what they do.

*One that is particularly helpful:*

*1. `data_prep_code` > `fishglob_species` >`data_clean_visualization_cell_year.Rmd`: This script visually shows the years and cells excluded from the analyses for each survey (these plots created in `data_prep_code` > `fishglob_species` > `standardize_temp_space_2.Rmd`)*

**Species Names**

- For list of species names,  see here: `output` > `spp_list.txt`

**Source scripts for figures and tables**

Main text:

- Figure 1: `figure_code` > `visualization_homogenization_differentiation.Rmd` then `figure_code` > `Map_surveys_coefvalues.Rmd` 
- Figure 2: `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd`
- Figure 3: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`

Supplemental Figures:

- Figure A: Conceptual figure made manually.
- Figure B: `data_prep_code` > `standardize_temp_space_2.Rmd`
- Figure C: `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd`
- Figure D: `analysis_code` > `year_dissimilarity_BC_total_models_4b_nullmodelreshuffle.Rmd`
- Figure E: `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd` with manual edit (legend) in `figures` > `Dissimilarity_Coef_errorbar_reduced_colorbytrend_LINEAR_MODEL_comparison_legend.pptx`
- Figure F: `analysis_code` > `year_dissimilarity_jaccard_4c_15perc_excl.Rmd` & `year_dissimilarity_jaccard_4d_onethird_excl.Rmd` with manual edit (legend) in `figures` > `Dissimilarity_Coef_errorbar_reduced_colorbytrend_LINEAR_MODEL_sensitivity_legend.pptx`
- Figure G: `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd`
- Figure H: `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd`
- Figure I: `analysis_code` > `Regional_statistics_7.Rmd`
- Figure J: `analysis_code` > `Regional_statistics_7.Rmd`
- Figure K: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Figure L: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Figure M: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Figure N: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Figure O: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Figure P: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`

Supplemental Tables

- Table A: `data_providers_allsurveys.xlsx`, and see Maureaud et al. 2021 Global Change Biology
- Table B: `analysis_code` > `Regional_statistics_7.Rmd`
- Table C: `data_prep_code` > `standardize_temp_space_2.Rmd`
- Table D: Manually constructed.
- Table E: Manually constructed.
- Table F: `analysis_code` > `year_dissimilarity_BC_total_models_4a.Rmd`
- Table G: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Table H: `analysis_code` > `annual_dissim_fishing_temp_model_8.Rmd`
- Table I: `analysis_code` > `annual_dissim_fishing_temp_model_8b_oisst.Rmd`
- Table J: `analysis_code` > `annual_dissim_fishing_temp_model_8b_oisst.Rmd`


## Notes
* Most of these analyses were run on a personal computer using R 4.2.1, and should be easy to reproduce for public data. The exception is the temperature extraction and averaging, as these require averaging of extremely large source files. Therefore, we recommend users to start with averaged temperature files, `SODA_data_temp_avgs_full.rds` & `OISST_data_temp_avgs_full.rds`.
