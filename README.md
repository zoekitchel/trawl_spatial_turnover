# Marine fish communities cycle between homogenized and differentiated states through time

Currently in preparation for PNAS.

*Zoë J. Kitchel, Aurore M. Maureaud, Alexa Fredston, Nancy Shackell, Bastien Mérigot, James T. Thorson, Laurène Pécuchet, Juliano Palacios-Abrantes, Deng M. L. Palomares, Antonio Esteban Acón, Mark Belchier, Gioacchino Bono, Pierluigi Carbonara, Martin A. Collins, Luis A. Cubillos, Tracey P. Fairweather, Maria Cristina Follesa, Cristina Garciá Ruiz, Germana Garofalo, Beatriz Guijarro, Igor Isajlović, Johannes N. Kathena, Mariono Koen-Alonso, Porzia Maiorano, Chiara Manfredi, Jurgen Mifsud, Richard L. O’Driscoll, Mario Sbrana, Jón Sólmundsson, Maria Teresa Spedicato, Fabrice Stephenson, Karl-Michael Werner, Daniela V. Yepsen, Walter Zupa, Malin L. Pinsky*

Please contact [Z.J. Kitchel](https://www.zoekithcel.com/) with questions about this project. The results are partially reproducible from the scripts and data files that can be shared are either in this GitHub repository or (if they are too large) hosted on [OSF](https://osf.io/) (as described below). 

## Where do data come from?

We used of a number of datasets that are already publicly available and/or published with this project, in addition to some regional datasets that may be available upon request from data providers. These are fully described and cited in the manuscript, but we also list them here for ease of download, access, and attribution. 

* Publically available trawl data from [FISHGLOB](https://github.com/AquaAuma/FishGlob_data), a project to harmonize publicly available trawl survey records from federal agencies around the globe. The raw data files from FISHGLOB are too big to host on GitHub but they are available on [OSF](https://osf.io/).
* Some regions are unable to share trawl data publically. Data may be available on request from data provider. See Table S1 for contact information.
* Sea bottom temperature data from [SODA 3.3.2](http://www.soda.umd.edu/), an ocean reanalysis data product by the University of Maryland available beginning in 1980. 
* Sea surface temperature data from [OISST](https://www.ncei.noaa.gov/products/optimum-interpolation-sst), a historical satellite temperature record from the U.S. National Oceanic and Atmospheric Administration beginning in 1982.
* Historical fishing pressure estimates from [Sea Around Us](https://www.seaaroundus.org/).


## What's in this repository?

The repository is organized as follows:

* `data_prep_code` contains Rmd scripts to access (when possible) and prepare trawl, temperature, and fishing datasets.
* `analysis_code` contains Rmd scripts to run all dissimilarity analyses.
* `data` contains raw datasets obtained from other sources (described above).
* `output` contains outputs of scripts that filter, clean, summarize, or analyze data.
* `figures` contains image files generated by scripts for the main and supplemental figures.
* `tables` contains csv and Rds files generated by scripts for main and supplemental tables.
* `archive` includes a mismash of scripts,output, figures, and tables that were a part of project development, but do not directly connect to currently used scripts, outputs, figures, or tables. Viewer beware, these are very possibly **wrong**, broken and non-functional but mean something significant to the authors, and are therefore included because ZJK is a hoarder.

## What's not in the repository? 

The following files are too big to host on GitHub and are available on [OSF](https://osf.io/) only:

- The raw publically available FISHGLOB data (a slightly earlier version of the dataset described in [Maureaud et al. 2023](https://doi.org/10.31219/osf.io/2bcjw)), `FISHGLOB_public_v1.5_clean.csv`. This should be downloaded from [OSF](https://osf.io/) and moved to `raw-data` to reproduce analyses for public surveys only.
- Norway (Barents Sea) required a data update in September 2023. Therefore, Norway is excluded from `FISHGLOB_public_v1.5_clean.csv`, and Norway data can be found in `data` > `Norway_Sep2023` > `NOR-BTS_clean.RData`. This file can be merged (with care) with `FISHGLOB_public_v1.5_clean.csv`.

We did not host the raw SODA and OISST data on OSF because the source files are very large. The SODA sea bottom temperature data were downloaded from [http://www.soda.umd.edu/](http://www.soda.umd.edu/) (accessed May 28, 2023). The NOAA OISST data were downloaded from https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/ (accessed May 19, 2023). 

We respect that trawl survey data for some regions are not currently publically available. Therefore, we cannot share survey data for South Georgia,the Mediterranean, South Africa, Chile, Namibia, Newfoundland, Greenland, Iceland, or New Zealand. This repository includes scripts that will prepare and process these data, but does not include raw data files for these regions. Table S1 lists data providers/corresponding authors for each region.

## In what order should things be run?

To reproduce the analysis, run these scripts in order:

1. `data_prep_code` > `fishglob_species` > `prepare_fishglob_dataset_1.Rmd`: This script prepares bottom trawl survey data observations for analysis using survey by survey specific edits. It also integrates data that needed to be updated from FISHGLOB v1.5 -- Norway and Greenland specifically.
1. `data_prep_code` > `fishglob_species` > `standardize_temp_space_2.Rmd`: This script standardizes bottom trawl survey data across space and time. Specifically, it assigns all trawl locations to hexagonal cells, removes any years for a survey that sample less than 70% of cells ever sampled for that survey and then removes any cells that are sampled in less than 70% of years.
1. 


## Notes
UNDER CONSTRUCTION
* Software versions used in this analysis are captured by `renv` and listed [in the lockfile](....renv.lock). Here is [a summary of how renv works](https://rstudio.github.io/renv/articles/renv.html). 
* Most of these analyses were run on a personal computer, and should be easy to reproduce, except `` and ``, which were conducted in R 3.6.0 on a machine with the following specifications: Windows Server 2019 2-Intel 6154 Xeon 3.0Ghz 18cores(36 threads) each 512 GB memory 6TB- SSD storage 18TB- HDD storage NVIDIA P4000 8Gb 10Gb ethernet
